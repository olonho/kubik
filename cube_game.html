<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Persy House</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #score {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 24px;
            font-weight: bold;
            z-index: 100;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.7), rgba(50, 50, 50, 0.6));
            padding: 12px 20px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        #instructions {
            position: absolute;
            top: 90px;
            left: 20px;
            color: #f0f0f0;
            font-size: 14px;
            z-index: 100;
            background: linear-gradient(135deg, rgba(30, 30, 30, 0.8), rgba(60, 60, 60, 0.7));
            padding: 10px 15px;
            border-radius: 12px;
            border: 2px solid rgba(100, 200, 255, 0.4);
            box-shadow: 0 3px 12px rgba(0, 100, 200, 0.3);
            backdrop-filter: blur(3px);
        }
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 48px;
            display: none;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.9);
            text-align: center;
        }
        #restart {
            font-size: 24px;
            margin-top: 20px;
            padding: 10px 30px;
            cursor: pointer;
            background-color: #4CAF50;
            border: none;
            color: white;
            border-radius: 5px;
        }
        #restart:hover {
            background-color: #45a049;
        }
        #changeSkin {
            font-size: 24px;
            margin-top: 20px;
            padding: 10px 30px;
            cursor: pointer;
            background-color: #FF9800;
            border: none;
            color: white;
            border-radius: 5px;
        }
        #changeSkin:hover {
            background-color: #F57C00;
        }
        #skinMenu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            z-index: 200;
        }
        #skinMenu h2 {
            color: white;
            font-size: 36px;
            margin-bottom: 30px;
        }
        .skin-options {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        .skin-button {
            background-color: #fff;
            border: 3px solid #4CAF50;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 150px;
        }
        .skin-button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.8);
        }
        .skin-button h3 {
            margin: 10px 0 0 0;
            font-size: 20px;
            color: #333;
        }
        .skin-icon {
            font-size: 60px;
            margin-bottom: 10px;
        }
        #crosshair {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            pointer-events: none;
            z-index: 1000;
        }
        .crosshair-line {
            position: absolute;
            background-color: rgba(255, 0, 0, 0.8);
        }
        .crosshair-h {
            width: 30px;
            height: 2px;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
        }
        .crosshair-v {
            width: 2px;
            height: 30px;
            left: 50%;
            top: 0;
            transform: translateX(-50%);
        }
        .crosshair-dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background-color: rgba(255, 0, 0, 0.8);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        #weaponDisplay {
            position: absolute;
            top: 155px;
            left: 20px;
            color: #ffd700;
            font-size: 18px;
            font-weight: bold;
            z-index: 100;
            background: linear-gradient(135deg, rgba(60, 40, 0, 0.8), rgba(100, 70, 0, 0.7));
            padding: 8px 15px;
            border-radius: 12px;
            border: 2px solid rgba(255, 215, 0, 0.5);
            box-shadow: 0 3px 12px rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(3px);
        }
        #ammoDisplay {
            position: absolute;
            top: 195px;
            left: 20px;
            font-size: 20px;
            font-weight: bold;
            z-index: 100;
            background: linear-gradient(135deg, rgba(40, 40, 40, 0.8), rgba(70, 70, 70, 0.7));
            padding: 8px 15px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 100, 0.5);
            box-shadow: 0 3px 12px rgba(255, 255, 0, 0.3);
            backdrop-filter: blur(3px);
        }
        #cameraMode {
            position: absolute;
            top: 235px;
            left: 20px;
            color: #87ceeb;
            font-size: 16px;
            font-weight: bold;
            z-index: 100;
            background: linear-gradient(135deg, rgba(0, 50, 100, 0.8), rgba(0, 80, 150, 0.7));
            padding: 8px 15px;
            border-radius: 12px;
            border: 2px solid rgba(135, 206, 235, 0.5);
            box-shadow: 0 3px 12px rgba(100, 150, 255, 0.3);
            backdrop-filter: blur(3px);
        }

        /* –ú–æ–±–∏–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        #mobileControls {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 250px;
            z-index: 150;
            pointer-events: none;
        }

        .control-button {
            position: absolute;
            width: 70px;
            height: 70px;
            background-color: rgba(255, 255, 255, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            pointer-events: auto;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .control-button:active {
            background-color: rgba(255, 255, 255, 0.6);
            transform: scale(0.95);
        }

        #leftBtn { bottom: 90px; left: 20px; }
        #rightBtn { bottom: 90px; left: 110px; }
        #jumpBtn { bottom: 20px; left: 65px; width: 80px; height: 80px; font-size: 36px; }
        #shootBtn { bottom: 90px; right: 20px; background-color: rgba(255, 100, 100, 0.4); border-color: rgba(255, 100, 100, 0.9); width: 80px; height: 80px; font-size: 36px; }
        #shootBtn:active { background-color: rgba(255, 100, 100, 0.7); }
        #weapon1Btn { bottom: 180px; right: 20px; width: 60px; height: 60px; font-size: 20px; }
        #weapon2Btn { bottom: 180px; right: 90px; width: 60px; height: 60px; font-size: 20px; }
        #weapon3Btn { bottom: 180px; right: 160px; width: 60px; height: 60px; font-size: 20px; }
        #weapon4Btn { bottom: 180px; right: 230px; width: 60px; height: 60px; font-size: 20px; }
        #cameraModeBtn { top: 150px; right: 20px; width: 60px; height: 60px; font-size: 24px; background-color: rgba(100, 150, 255, 0.4); border-color: rgba(100, 150, 255, 0.9); }
        #cameraModeBtn:active { background-color: rgba(100, 150, 255, 0.7); }

        #shopMenu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            z-index: 200;
            max-height: 80vh;
            overflow-y: auto;
            min-width: 600px;
            position: relative;
        }
        #closeShopX:hover {
            background-color: rgba(255, 50, 50, 1);
            transform: scale(1.1);
        }
        #closeShop:hover {
            background-color: #45a049;
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.7);
        }
        #exitToMenu:hover {
            background-color: #F57C00;
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.7);
        }
        #shopMenu h2 {
            color: white;
            font-size: 42px;
            margin-bottom: 20px;
        }
        #shopMenu h3 {
            font-size: 28px;
            margin-bottom: 15px;
        }
        .shop-items {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .shop-item {
            background: linear-gradient(135deg, rgba(50, 50, 50, 0.8), rgba(30, 30, 30, 0.8));
            border: 3px solid #4CAF50;
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 140px;
            position: relative;
        }
        .shop-item:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.8);
        }
        .shop-item.owned {
            border-color: #FFD700;
            background: linear-gradient(135deg, rgba(80, 80, 30, 0.8), rgba(60, 60, 10, 0.8));
        }
        .shop-item.owned::after {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 10px;
            color: #FFD700;
            font-size: 24px;
            font-weight: bold;
        }
        .shop-item-icon {
            font-size: 50px;
            margin-bottom: 10px;
        }
        .shop-item-name {
            color: white;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .shop-item-price {
            color: #FFD700;
            font-size: 18px;
            font-weight: bold;
        }
        .shop-item-desc {
            color: #aaa;
            font-size: 12px;
            margin-top: 5px;
        }
        #coinsDisplay {
            background: linear-gradient(135deg, rgba(80, 60, 0, 0.8), rgba(120, 90, 0, 0.7));
            padding: 8px 15px;
            border-radius: 12px;
            border: 2px solid rgba(255, 215, 0, 0.6);
            box-shadow: 0 3px 12px rgba(255, 215, 0, 0.4);
            backdrop-filter: blur(3px);
        }
        @media (max-width: 768px) {
            #mobileControls { display: block; }
            #instructions { font-size: 12px; top: 50px; }
            #shopMenu { min-width: 90%; padding: 20px; }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="js/game.js"></script>
    <script src="js/weapons.js"></script>
    <script src="js/decorations.js"></script>
    <script src="js/shop.js"></script>
</head>
<body>
    <div id="skinMenu">
        <h2>–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h2>
        <div class="skin-options" style="flex-wrap: wrap; max-width: 800px; margin: 0 auto;">
            <div class="skin-button" onclick="selectSkin('dog')">
                <div class="skin-icon">üê∂</div>
                <h3>–°–æ–±–∞—á–∫–∞</h3>
            </div>
            <div class="skin-button" onclick="selectSkin('cat')">
                <div class="skin-icon">üê±</div>
                <h3>–ö–æ—à–µ—á–∫–∞</h3>
            </div>
            <div class="skin-button" onclick="selectSkin('fox')">
                <div class="skin-icon">ü¶ä</div>
                <h3>–õ–∏—Å–∏—á–∫–∞</h3>
            </div>
            <div class="skin-button" onclick="selectSkin('panda')">
                <div class="skin-icon">üêº</div>
                <h3>–ü–∞–Ω–¥–∞</h3>
            </div>
            <div class="skin-button" onclick="selectSkin('rabbit')">
                <div class="skin-icon">üê∞</div>
                <h3>–ó–∞–π—á–∏–∫</h3>
            </div>
            <div class="skin-button" onclick="selectSkin('robot')">
                <div class="skin-icon">ü§ñ</div>
                <h3>–†–æ–±–æ—Ç</h3>
            </div>
            <div class="skin-button" onclick="selectSkin('cube')">
                <div class="skin-icon">üü¶</div>
                <h3>–ö–≤–∞–¥—Ä–∞—Ç–∏–∫</h3>
            </div>
            <div class="skin-button" onclick="selectSkin('oval')">
                <div class="skin-icon">‚ö™</div>
                <h3>–û–≤–∞–ª</h3>
            </div>
        </div>
    </div>

    <div id="score" style="display: none;">–°—á—ë—Ç: 0 | –£—Ä–æ–≤–µ–Ω—å: 1 | –ñ–∏–∑–Ω–∏: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    <div id="instructions" style="display: none;">‚Üê ‚Üí : –î–≤–∏–∂–µ–Ω–∏–µ | –ü—Ä–æ–±–µ–ª: –ü—Ä—ã–∂–æ–∫ | W: –°—Ç—Ä–µ–ª—è—Ç—å | 1: –ü–∏—Å—Ç–æ–ª–µ—Ç | 2: –í–∏–Ω—Ç–æ–≤–∫–∞ | 3: –õ–∞–∑–µ—Ä* | 4: –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è* | ENTER: –í–∏–¥ | B: –ú–∞–≥–∞–∑–∏–Ω</div>
    <div id="weaponDisplay" style="display: none;">
        –û—Ä—É–∂–∏–µ: üî´ –ü–∏—Å—Ç–æ–ª–µ—Ç
    </div>
    <div id="ammoDisplay" style="display: none;">
        –ü–∞—Ç—Ä–æ–Ω—ã: 80 / 80
    </div>
    <div id="cameraMode" style="display: none;">
        –í–∏–¥: –û—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞
    </div>
    <div id="coinsDisplay" style="display: none; position: absolute; top: 180px; left: 20px; color: gold; font-size: 22px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); z-index: 100;">
        üí∞ –ú–æ–Ω–µ—Ç—ã: 0
    </div>
    <button id="openShopBtn" style="display: none; position: absolute; top: 210px; left: 20px; padding: 10px 20px; background-color: rgba(255, 215, 0, 0.9); border: 3px solid gold; border-radius: 10px; color: #000; font-size: 18px; font-weight: bold; cursor: pointer; z-index: 100; text-shadow: 1px 1px 2px rgba(255,255,255,0.5);">
        üí∞ –ü–∞—Ç—Ä–æ–Ω—ã
    </button>
    <button id="openItemsShopBtn" style="display: none; position: absolute; top: 250px; left: 20px; padding: 10px 20px; background-color: rgba(100, 150, 255, 0.9); border: 3px solid #6699ff; border-radius: 10px; color: #fff; font-size: 18px; font-weight: bold; cursor: pointer; z-index: 100; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
        üõí –ú–∞–≥–∞–∑–∏–Ω
    </button>
    <div id="gameOver">
        <div>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</div>
        <div style="font-size: 24px; margin-top: 10px;">–í–∞—à —Å—á—ë—Ç: <span id="finalScore">0</span></div>
        <div style="font-size: 20px; margin-top: 5px;">–£—Ä–æ–≤–µ–Ω—å: <span id="finalLevel">1</span></div>
        <div style="font-size: 22px; margin-top: 5px; color: gold;">üèÜ –†–µ–∫–æ—Ä–¥: <span id="finalHighScore">0</span></div>
        <button id="restart">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
        <button id="changeSkin" style="margin-left: 10px; background-color: #FF9800;">–°–º–µ–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
    </div>


    <!-- –ú–∞–≥–∞–∑–∏–Ω –±–æ–µ–ø—Ä–∏–ø–∞—Å–æ–≤ -->
    <div id="shopMenu" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: rgba(0, 0, 0, 0.95); padding: 40px; border-radius: 20px; text-align: center; z-index: 300; border: 5px solid gold;">
        <h2 style="color: gold; font-size: 42px; margin-bottom: 20px;">üõí –ú–∞–≥–∞–∑–∏–Ω –±–æ–µ–ø—Ä–∏–ø–∞—Å–æ–≤</h2>
        <div style="color: white; font-size: 24px; margin-bottom: 30px;">
            üí∞ –í–∞—à–∏ –º–æ–Ω–µ—Ç—ã: <span id="shopCoins" style="color: gold; font-weight: bold;">0</span>
        </div>

        <div style="background-color: rgba(255, 255, 255, 0.1); padding: 30px; border-radius: 15px; margin: 20px 0;">
            <div style="color: white; font-size: 28px; margin-bottom: 15px;">üì¶ –ù–∞–±–æ—Ä –ø–∞—Ç—Ä–æ–Ω–æ–≤</div>
            <div style="color: #FFD700; font-size: 22px; margin-bottom: 15px;">+40 –ø–∞—Ç—Ä–æ–Ω–æ–≤</div>
            <div style="color: #FFA500; font-size: 20px; margin-bottom: 20px;">–¶–µ–Ω–∞: 50 üí∞</div>
            <button id="buyAmmoBtn" style="padding: 15px 40px; background-color: #4CAF50; border: none; border-radius: 10px; color: white; font-size: 22px; font-weight: bold; cursor: pointer; transition: transform 0.2s;">
                –ö—É–ø–∏—Ç—å –ø–∞—Ç—Ä–æ–Ω—ã
            </button>
        </div>

        <div style="background-color: rgba(255, 255, 255, 0.1); padding: 30px; border-radius: 15px; margin: 20px 0;">
            <div style="color: white; font-size: 28px; margin-bottom: 15px;">üì¶ –ë–æ–ª—å—à–æ–π –Ω–∞–±–æ—Ä –ø–∞—Ç—Ä–æ–Ω–æ–≤</div>
            <div style="color: #FFD700; font-size: 22px; margin-bottom: 15px;">+100 –ø–∞—Ç—Ä–æ–Ω–æ–≤</div>
            <div style="color: #FFA500; font-size: 20px; margin-bottom: 20px;">–¶–µ–Ω–∞: 100 üí∞</div>
            <button id="buyAmmoBigBtn" style="padding: 15px 40px; background-color: #4CAF50; border: none; border-radius: 10px; color: white; font-size: 22px; font-weight: bold; cursor: pointer; transition: transform 0.2s;">
                –ö—É–ø–∏—Ç—å –ø–∞—Ç—Ä–æ–Ω—ã
            </button>
        </div>

        <button id="closeShopBtn" style="margin-top: 20px; padding: 12px 30px; background-color: #f44336; border: none; border-radius: 10px; color: white; font-size: 20px; font-weight: bold; cursor: pointer;">
            –ó–∞–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω
        </button>

        <div id="shopMessage" style="display: none; margin-top: 20px; padding: 15px; border-radius: 10px; font-size: 20px; font-weight: bold;"></div>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (—Å–∫–∏–Ω—ã, –æ—Ä—É–∂–∏–µ, —Ç—É—Ä–µ–ª—å) -->
    <div id="itemsShopMenu" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.95); z-index: 400; overflow-y: auto;">
        <div style="max-width: 1200px; margin: 50px auto; padding: 40px;">
            <div id="shopRewardMessage" style="display: none; text-align: center; margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 165, 0, 0.3)); border-radius: 15px; border: 3px solid gold;">
                <h2 style="color: gold; font-size: 48px; margin: 10px 0;">üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ</h2>
                <p style="color: white; font-size: 28px;">–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ <span id="rewardLevel">10</span> —É—Ä–æ–≤–Ω—è!</p>
                <p style="color: gold; font-size: 32px; font-weight: bold;">+300 –º–æ–Ω–µ—Ç! üí∞</p>
            </div>

            <h2 style="color: gold; font-size: 42px; text-align: center; margin-bottom: 10px;">üõí –ú–∞–≥–∞–∑–∏–Ω</h2>
            <div style="color: white; font-size: 24px; text-align: center; margin-bottom: 30px;">
                üí∞ –í–∞—à–∏ –º–æ–Ω–µ—Ç—ã: <span id="shopCoins" style="color: gold; font-weight: bold;">0</span>
            </div>

            <!-- –¢—É—Ä–µ–ª—å -->
            <h3 style="color: #ff5555; font-size: 32px; margin: 30px 0 20px 0; text-align: center;">‚ö° –ë–æ–µ–≤–∞—è –¢—É—Ä–µ–ª—å ‚ö°</h3>
            <div id="shopTurret" style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 40px;"></div>

            <!-- –°–∫–∏–Ω—ã -->
            <h3 style="color: white; font-size: 32px; margin: 30px 0 20px 0; text-align: center;">üë§ –ü–µ—Ä—Å–æ–Ω–∞–∂–∏</h3>
            <div id="shopSkins" style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 40px;"></div>

            <!-- –û—Ä—É–∂–∏–µ -->
            <h3 style="color: white; font-size: 32px; margin: 30px 0 20px 0; text-align: center;">üî´ –û—Ä—É–∂–∏–µ</h3>
            <div id="shopWeapons" style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 40px;"></div>

            <div style="text-align: center; margin-top: 40px;">
                <button id="continueBtn" style="padding: 15px 40px; background-color: #4CAF50; border: none; border-radius: 10px; color: white; font-size: 24px; font-weight: bold; cursor: pointer; margin: 0 10px;">
                    –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É
                </button>
                <button id="exitShopBtn" style="padding: 15px 40px; background-color: #f44336; border: none; border-radius: 10px; color: white; font-size: 24px; font-weight: bold; cursor: pointer; margin: 0 10px;">
                    –í—ã–π—Ç–∏ –≤ –º–µ–Ω—é
                </button>
            </div>
        </div>
    </div>

    <style>
        .shop-item {
            background: linear-gradient(135deg, rgba(60, 60, 60, 0.9), rgba(40, 40, 40, 0.9));
            padding: 20px;
            border-radius: 15px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            min-width: 150px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-align: center;
        }
        .shop-item:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        .shop-item.owned {
            opacity: 0.6;
            cursor: default;
            border-color: rgba(76, 175, 80, 0.5);
        }
        .shop-item.owned:hover {
            transform: none;
            box-shadow: none;
        }
        .shop-item-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        .shop-item-name {
            color: white;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .shop-item-desc {
            color: #aaa;
            font-size: 12px;
            margin-bottom: 10px;
        }
        .shop-item-price {
            color: gold;
            font-size: 20px;
            font-weight: bold;
        }
    </style>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω—ã –≤ js/game.js

        // –ú–∞–≥–∞–∑–∏–Ω –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        const shopItems = {
            skins: [
                { id: 'dragon', name: '–î—Ä–∞–∫–æ–Ω', icon: 'üêâ', price: 100 },
                { id: 'unicorn', name: '–ï–¥–∏–Ω–æ—Ä–æ–≥', icon: 'ü¶Ñ', price: 150 },
                { id: 'tiger', name: '–¢–∏–≥—Ä', icon: 'üêØ', price: 120 },
                { id: 'alien', name: '–ò–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω–∏–Ω', icon: 'üëΩ', price: 200 },
                { id: 'ninja', name: '–ù–∏–Ω–¥–∑—è', icon: 'ü•∑', price: 180 },
                { id: 'wizard', name: '–í–æ–ª—à–µ–±–Ω–∏–∫', icon: 'üßô', price: 250 }
            ],
            weapons: [
                { id: 'machinegun', name: '–ü—É–ª–µ–º—ë—Ç', icon: 'üî´üí®', price: 300, description: '–ê–≤—Ç–æ, 80 –ø–∞—Ç—Ä–æ–Ω–æ–≤', ammo: 80 },
                { id: 'shotgun', name: '–î—Ä–æ–±–æ–≤–∏–∫', icon: 'üí•üî´', price: 250, description: '–î—Ä–æ–±—å, 25 –ø–∞—Ç—Ä–æ–Ω–æ–≤', ammo: 25 },
                { id: 'sniper', name: '–°–Ω–∞–π–ø–µ—Ä–∫–∞', icon: 'üéØüî≠', price: 400, description: '–ú–æ—â–Ω–æ, 15 –ø–∞—Ç—Ä–æ–Ω–æ–≤', ammo: 15 },
                { id: 'laser', name: '–õ–∞–∑–µ—Ä', icon: '‚ö°üî´', price: 500, description: '–ë—ã—Å—Ç—Ä–æ, 120 –ø–∞—Ç—Ä–æ–Ω–æ–≤', ammo: 120 },
                { id: 'rocket', name: '–†–∞–∫–µ—Ç–Ω–∏—Ü–∞', icon: 'üöÄüí•', price: 600, description: '–í–∑—Ä—ã–≤, 12 –ø–∞—Ç—Ä–æ–Ω–æ–≤', ammo: 12 },
                { id: 'crossbow', name: '–ê—Ä–±–∞–ª–µ—Ç', icon: 'üèπ', price: 200, description: '–°—Ç—Ä–µ–ª—ã, 40 –ø–∞—Ç—Ä–æ–Ω–æ–≤', ammo: 40 },
                { id: 'plasma', name: '–ü–ª–∞–∑–º–∞', icon: '‚öõÔ∏èüí´', price: 700, description: '–≠–Ω–µ—Ä–≥–∏—è, 60 –ø–∞—Ç—Ä–æ–Ω–æ–≤', ammo: 60 }
            ]
        };

        function openShop(showReward = false) {
            document.getElementById('itemsShopMenu').style.display = 'block';
            document.getElementById('score').style.display = 'none';
            document.getElementById('instructions').style.display = 'none';
            document.getElementById('weaponDisplay').style.display = 'none';
            document.getElementById('ammoDisplay').style.display = 'none';
            document.getElementById('cameraMode').style.display = 'none';
            document.getElementById('coinsDisplay').style.display = 'none';
            document.getElementById('crosshair').style.display = 'none';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞–≥—Ä–∞–¥–µ –µ—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è 10 —É—Ä–æ–≤–Ω–µ–π
            if (showReward) {
                document.getElementById('shopRewardMessage').style.display = 'block';
                document.getElementById('rewardLevel').textContent = level;
            } else {
                document.getElementById('shopRewardMessage').style.display = 'none';
            }

            updateShopDisplay();
        }


        function updateShopDisplay() {
            document.getElementById('shopCoins').textContent = coins;

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–∫–∏–Ω—ã
            const skinsContainer = document.getElementById('shopSkins');
            skinsContainer.innerHTML = '';
            shopItems.skins.forEach(item => {
                const owned = ownedSkins.includes(item.id);
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item' + (owned ? ' owned' : '');
                itemDiv.innerHTML = `
                    <div class="shop-item-icon">${item.icon}</div>
                    <div class="shop-item-name">${item.name}</div>
                    <div class="shop-item-price">${owned ? '–ö—É–ø–ª–µ–Ω–æ' : 'üí∞ ' + item.price}</div>
                `;
                if (!owned) {
                    itemDiv.onclick = () => buyItem('skin', item);
                }
                skinsContainer.appendChild(itemDiv);
            });

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ—Ä—É–∂–∏–µ
            const weaponsContainer = document.getElementById('shopWeapons');
            weaponsContainer.innerHTML = '';
            shopItems.weapons.forEach(item => {
                const owned = ownedWeapons.includes(item.id);
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item' + (owned ? ' owned' : '');
                itemDiv.innerHTML = `
                    <div class="shop-item-icon">${item.icon}</div>
                    <div class="shop-item-name">${item.name}</div>
                    <div class="shop-item-desc">${item.description}</div>
                    <div class="shop-item-price">${owned ? '–ö—É–ø–ª–µ–Ω–æ' : 'üí∞ ' + item.price}</div>
                `;
                if (!owned) {
                    itemDiv.onclick = () => buyItem('weapon', item);
                }
                weaponsContainer.appendChild(itemDiv);
            });

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç—É—Ä–µ–ª–∏
            const turretContainer = document.getElementById('shopTurret');
            if (turretContainer) {
                turretContainer.innerHTML = '';

                // –û–±—ã—á–Ω–∞—è —Ç—É—Ä–µ–ª—å
                const turretItem = document.createElement('div');
                turretItem.className = 'shop-item' + (hasTurret ? ' owned' : '');
                turretItem.style.backgroundColor = 'rgba(100, 100, 100, 0.2)';
                turretItem.style.border = '3px solid rgba(150, 150, 150, 0.5)';
                turretItem.innerHTML = `
                    <div class="shop-item-icon" style="font-size: 48px;">üî´‚ö°</div>
                    <div class="shop-item-name" style="color: #aaaaaa; font-size: 20px;">–ë–æ–µ–≤–∞—è –¢—É—Ä–µ–ª—å</div>
                    <div class="shop-item-desc" style="color: #cccccc;">–ë—ã—Å—Ç—Ä–∞—è —Å—Ç—Ä–µ–ª—å–±–∞</div>
                    <div class="shop-item-price" style="font-size: 20px; color: gold;">${hasTurret ? '‚úì –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞' : 'üí∞ 1000'}</div>
                `;
                if (!hasTurret) {
                    turretItem.onclick = () => buyTurret('basic');
                }
                turretContainer.appendChild(turretItem);

                // –û–≥–Ω–µ–≤–∞—è —Ç—É—Ä–µ–ª—å
                const fireTurretItem = document.createElement('div');
                fireTurretItem.className = 'shop-item' + (hasFireTurret ? ' owned' : '');
                fireTurretItem.style.backgroundColor = 'rgba(255, 100, 0, 0.2)';
                fireTurretItem.style.border = '3px solid rgba(255, 100, 0, 0.5)';
                fireTurretItem.innerHTML = `
                    <div class="shop-item-icon" style="font-size: 48px;">üî•üí•</div>
                    <div class="shop-item-name" style="color: #ff6600; font-size: 20px;">–û–≥–Ω–µ–≤–∞—è –¢—É—Ä–µ–ª—å</div>
                    <div class="shop-item-desc" style="color: #ffaa88;">–û–≥–Ω–µ–Ω–Ω—ã–µ —à–∞—Ä—ã!</div>
                    <div class="shop-item-price" style="font-size: 20px; color: gold;">${hasFireTurret ? '‚úì –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞' : 'üí∞ 1500'}</div>
                `;
                if (!hasFireTurret) {
                    fireTurretItem.onclick = () => buyTurret('fire');
                }
                turretContainer.appendChild(fireTurretItem);

                // –õ–∞–∑–µ—Ä–Ω–∞—è —Ç—É—Ä–µ–ª—å
                const laserTurretItem = document.createElement('div');
                laserTurretItem.className = 'shop-item' + (hasLaserTurret ? ' owned' : '');
                laserTurretItem.style.backgroundColor = 'rgba(0, 200, 255, 0.2)';
                laserTurretItem.style.border = '3px solid rgba(0, 200, 255, 0.5)';
                laserTurretItem.innerHTML = `
                    <div class="shop-item-icon" style="font-size: 48px;">‚ö°üî∑</div>
                    <div class="shop-item-name" style="color: #00ccff; font-size: 20px;">–õ–∞–∑–µ—Ä–Ω–∞—è –¢—É—Ä–µ–ª—å</div>
                    <div class="shop-item-desc" style="color: #aaeeff;">–°—É–ø–µ—Ä –±—ã—Å—Ç—Ä–∞—è!</div>
                    <div class="shop-item-price" style="font-size: 20px; color: gold;">${hasLaserTurret ? '‚úì –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞' : 'üí∞ 2000'}</div>
                `;
                if (!hasLaserTurret) {
                    laserTurretItem.onclick = () => buyTurret('laser');
                }
                turretContainer.appendChild(laserTurretItem);

                // –†–∞–∫–µ—Ç–Ω–∞—è —Ç—É—Ä–µ–ª—å
                const rocketTurretItem = document.createElement('div');
                rocketTurretItem.className = 'shop-item' + (hasRocketTurret ? ' owned' : '');
                rocketTurretItem.style.backgroundColor = 'rgba(150, 0, 200, 0.2)';
                rocketTurretItem.style.border = '3px solid rgba(150, 0, 200, 0.5)';
                rocketTurretItem.innerHTML = `
                    <div class="shop-item-icon" style="font-size: 48px;">üöÄüí£</div>
                    <div class="shop-item-name" style="color: #aa00ff; font-size: 20px;">–†–∞–∫–µ—Ç–Ω–∞—è –¢—É—Ä–µ–ª—å</div>
                    <div class="shop-item-desc" style="color: #ddaaff;">–ú–æ—â–Ω—ã–µ —Ä–∞–∫–µ—Ç—ã!</div>
                    <div class="shop-item-price" style="font-size: 20px; color: gold;">${hasRocketTurret ? '‚úì –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞' : 'üí∞ 2500'}</div>
                `;
                if (!hasRocketTurret) {
                    rocketTurretItem.onclick = () => buyTurret('rocket');
                }
                turretContainer.appendChild(rocketTurretItem);
            }
        }

        function buyItem(type, item) {
            if (coins >= item.price) {
                coins -= item.price;
                if (type === 'skin') {
                    ownedSkins.push(item.id);
                } else if (type === 'weapon') {
                    ownedWeapons.push(item.id);
                }
                updateShopDisplay();
                updateCoinsDisplay();
            } else {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç! –ù—É–∂–Ω–æ: ' + item.price + ', —É –≤–∞—Å: ' + coins);
            }
        }

        function buyTurret(type) {
            const prices = {
                basic: 1000,
                fire: 1500,
                laser: 2000,
                rocket: 2500
            };
            const price = prices[type];

            if (coins >= price) {
                coins -= price;

                switch(type) {
                    case 'basic':
                        hasTurret = true;
                        createTurret();
                        break;
                    case 'fire':
                        hasFireTurret = true;
                        createFireTurret();
                        break;
                    case 'laser':
                        hasLaserTurret = true;
                        createLaserTurret();
                        break;
                    case 'rocket':
                        hasRocketTurret = true;
                        createRocketTurret();
                        break;
                }

                updateShopDisplay();
                updateCoinsDisplay();
                localStorage.setItem('cubeGameCoins', coins);
            } else {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç! –ù—É–∂–Ω–æ: ' + price + ', —É –≤–∞—Å: ' + coins);
            }
        }

        function updateCoinsDisplay() {
            document.getElementById('coinsDisplay').textContent = 'üí∞ –ú–æ–Ω–µ—Ç—ã: ' + coins;
        }

        function selectSkin(skin) {
            selectedSkin = skin;

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥—Ä—ã
            score = 0;
            level = 1;
            lives = 3;
            ammo = maxAmmo;
            obstacleSpeed = 0.02; // –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–æ–º–±–∏
            spawnRate = 0.03; // –ú–Ω–æ–≥–æ –∑–æ–º–±–∏
            playerVelocityY = 0;
            isJumping = false;
            gameActive = true;
            cameraMode = 'firstPerson'; // –ù–∞—á–∏–Ω–∞–µ–º —Å –≤–∏–¥–∞ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞

            document.getElementById('skinMenu').style.display = 'none';
            document.getElementById('score').style.display = 'block';
            document.getElementById('instructions').style.display = 'block';
            document.getElementById('crosshair').style.display = 'block';
            document.getElementById('cameraMode').style.display = 'block';
            document.getElementById('coinsDisplay').style.display = 'block';
            document.getElementById('openShopBtn').style.display = 'block';
            document.getElementById('openItemsShopBtn').style.display = 'block';
            updateCoinsDisplay();
            init();
        }

        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é selectSkin –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        window.selectSkin = selectSkin;

        function init() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—É—é –∞–Ω–∏–º–∞—Ü–∏—é –µ—Å–ª–∏ –µ—Å—Ç—å
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }

            // –û—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤—ã
            obstacles = [];
            decorations = [];
            bullets = [];

            // –û—á–∏—â–∞–µ–º —Ç—É—Ä–µ–ª–∏
            turrets.forEach(turret => scene.remove(turret));
            turrets = [];

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ü–µ–ª—å –≤–∑–≥–ª—è–¥–∞ –∫–∞–º–µ—Ä—ã
            cameraLookTarget = new THREE.Vector3(0, 0.7, -10);

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87ceeb);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            // –í–∏–¥ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞ - –∫–∞–º–µ—Ä–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –≥–ª–∞–∑ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            camera.position.set(0, 1.2, 0);
            camera.lookAt(0, 0, 0);

            // –°–æ–∑–¥–∞—ë–º renderer —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ–≥–æ –µ—â–µ –Ω–µ—Ç
            if (!renderer) {
                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.shadowMap.enabled = true;
                document.body.appendChild(renderer.domElement);
            }

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            const groundGeometry = new THREE.PlaneGeometry(10, 100);
            const groundMaterial = new THREE.MeshPhongMaterial({ color: 0x228b22 });
            ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ä–µ–≤—å—è –ø–æ –∫—Ä–∞—è–º
            decorations = [];
            createTrees();

            // –°–æ–∑–¥–∞—ë–º —Ç—É—Ä–µ–ª–∏ –µ—Å–ª–∏ –±—ã–ª–∏ –∫—É–ø–ª–µ–Ω—ã
            if (hasTurret) {
                createTurret();
            }
            if (hasFireTurret) {
                createFireTurret();
            }
            if (hasLaserTurret) {
                createLaserTurret();
            }
            if (hasRocketTurret) {
                createRocketTurret();
            }

            // –°–æ–∑–¥–∞—ë–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–∫–∏–Ω–∞
            switch(selectedSkin) {
                case 'dog':
                    player = createDog();
                    break;
                case 'cat':
                    player = createCat();
                    break;
                case 'fox':
                    player = createFox();
                    break;
                case 'panda':
                    player = createPanda();
                    break;
                case 'rabbit':
                    player = createRabbit();
                    break;
                case 'robot':
                    player = createRobot();
                    break;
                case 'cube':
                    player = createCube();
                    break;
                case 'oval':
                    player = createOval();
                    break;
                default:
                    player = createDog();
            }
            player.position.set(0, 0.5, 0);
            // –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ª–∏—Ü–æ–º –∫ –∫—É–±–∏–∫–∞–º (–≤ —Å—Ç–æ—Ä–æ–Ω—É -Z)
            player.rotation.y = -Math.PI / 2;

            scene.add(player);

            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ä—É–∂–∏–µ –∫ –ø–µ—Ä—Å–æ–Ω–∞–∂—É (–≤ –ø—Ä–∞–≤—É—é —Ä—É–∫—É)
            currentWeapon = createWeapon(selectedWeapon);
            currentWeapon.position.set(0.15, 0.2, -0.4);
            currentWeapon.rotation.y = 0;
            currentWeapon.rotation.z = -Math.PI / 6;
            player.add(currentWeapon);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º UI –æ—Ä—É–∂–∏—è –∏ –ø–∞—Ç—Ä–æ–Ω–æ–≤
            document.getElementById('weaponDisplay').style.display = 'block';
            document.getElementById('weaponDisplay').textContent = '–û—Ä—É–∂–∏–µ: üî´ –ü–∏—Å—Ç–æ–ª–µ—Ç (–æ–¥–∏–Ω–æ—á–Ω—ã–µ)';
            document.getElementById('ammoDisplay').style.display = 'block';
            document.getElementById('cameraMode').style.display = 'block';
            document.getElementById('cameraMode').textContent = '–í–∏–¥: –û—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞';
            updateAmmoDisplay();

            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            animate();
        }

        function createTrees() {
            // –î–µ—Ä–µ–≤—å—è —Å–ª–µ–≤–∞ - –±–æ–ª—å—à–µ –¥–µ—Ä–µ–≤—å–µ–≤
            for (let i = 0; i < 25; i++) {
                const tree = createTree();
                tree.position.set(-5.5, 0, -i * 5 - 5);
                scene.add(tree);
                decorations.push(tree);
            }
            // –î–µ—Ä–µ–≤—å—è —Å–ø—Ä–∞–≤–∞ - –±–æ–ª—å—à–µ –¥–µ—Ä–µ–≤—å–µ–≤
            for (let i = 0; i < 25; i++) {
                const tree = createTree();
                tree.position.set(5.5, 0, -i * 5 - 5);
                scene.add(tree);
                decorations.push(tree);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–º–Ω–∏ - –±–æ–ª—å—à–µ –∫–∞–º–Ω–µ–π
            for (let i = 0; i < 20; i++) {
                const rock = createRock();
                const side = Math.random() > 0.5 ? -6 : 6;
                rock.position.set(side + (Math.random() - 0.5) * 0.5, 0, -i * 6 - 10);
                scene.add(rock);
                decorations.push(rock);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±–ª–∞–∫–∞ - –±–æ–ª—å—à–µ –æ–±–ª–∞–∫–æ–≤
            for (let i = 0; i < 20; i++) {
                const cloud = createCloud();
                cloud.position.set((Math.random() - 0.5) * 20, 8 + Math.random() * 4, -i * 8 - 20);
                scene.add(cloud);
                decorations.push(cloud);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –∫—É—Å—Ç—ã
            for (let i = 0; i < 30; i++) {
                const bush = createBush();
                const side = Math.random() > 0.5 ? -4.5 : 4.5;
                bush.position.set(side + (Math.random() - 0.5) * 0.8, 0, -i * 4 - Math.random() * 5);
                scene.add(bush);
                decorations.push(bush);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º —Ü–≤–µ—Ç—ã
            for (let i = 0; i < 40; i++) {
                const flower = createFlower();
                const side = Math.random() > 0.5 ? -4 : 4;
                flower.position.set(side + (Math.random() - 0.5) * 1.5, 0, -i * 3 - Math.random() * 4);
                scene.add(flower);
                decorations.push(flower);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–∞–≤—É
            for (let i = 0; i < 50; i++) {
                const grass = createGrass();
                const side = Math.random() > 0.5 ? -3.5 : 3.5;
                grass.position.set(side + (Math.random() - 0.5) * 2, 0, -i * 2.5 - Math.random() * 3);
                scene.add(grass);
                decorations.push(grass);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–±–æ—Ä—ã
            for (let i = 0; i < 15; i++) {
                const fence = createFence();
                const side = Math.random() > 0.5 ? -4.8 : 4.8;
                fence.position.set(side, 0, -i * 8 - 15);
                if (side > 0) {
                    fence.rotation.y = Math.PI;
                }
                scene.add(fence);
                decorations.push(fence);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ç–∏—Ü –≤ –Ω–µ–±–µ
            for (let i = 0; i < 12; i++) {
                const bird = createBird();
                bird.position.set(
                    (Math.random() - 0.5) * 15,
                    5 + Math.random() * 3,
                    -i * 10 - Math.random() * 10
                );
                scene.add(bird);
                decorations.push(bird);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞–∫–∏
            for (let i = 0; i < 8; i++) {
                const sign = createSign();
                const side = Math.random() > 0.5 ? -5 : 5;
                sign.position.set(side, 0, -i * 15 - 20);
                if (side > 0) {
                    sign.rotation.y = Math.PI;
                }
                scene.add(sign);
                decorations.push(sign);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–º —Å –∫–æ—à–∫–æ–π —Å–ø—Ä–∞–≤–∞ –æ—Ç –∏–≥—Ä–æ–∫–∞
            const house = createHouse();
            house.position.set(6, 0, 3);
            house.rotation.y = -Math.PI / 4; // –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –¥–æ–º –∫ –∏–≥—Ä–æ–∫—É
            scene.add(house);
            decorations.push(house);

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—à–∫—É –ø–µ—Ä–µ–¥ –¥–æ–º–æ–º
            const houseCat = createHouseCat();
            houseCat.position.set(5, 0, 5);
            houseCat.rotation.y = Math.PI; // –ö–æ—à–∫–∞ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –∏–≥—Ä–æ–∫–∞
            scene.add(houseCat);
            decorations.push(houseCat);
        }

        function createTree() {
            const treeGroup = new THREE.Group();

            // –°—Ç–≤–æ–ª
            const trunkGeometry = new THREE.CylinderGeometry(0.2, 0.3, 2, 8);
            const trunkMaterial = new THREE.MeshPhongMaterial({ color: 0x8B4513 });
            const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
            trunk.position.y = 1;
            trunk.castShadow = true;
            treeGroup.add(trunk);

            // –ö—Ä–æ–Ω–∞ (3 —Å—Ñ–µ—Ä—ã)
            const foliageGeometry = new THREE.SphereGeometry(0.8, 8, 8);
            const foliageMaterial = new THREE.MeshPhongMaterial({ color: 0x228B22 });

            const foliage1 = new THREE.Mesh(foliageGeometry, foliageMaterial);
            foliage1.position.y = 2.5;
            foliage1.castShadow = true;
            treeGroup.add(foliage1);

            const foliage2 = new THREE.Mesh(foliageGeometry, foliageMaterial);
            foliage2.position.y = 3.2;
            foliage2.scale.set(0.8, 0.8, 0.8);
            foliage2.castShadow = true;
            treeGroup.add(foliage2);

            return treeGroup;
        }

        function createRock() {
            const geometry = new THREE.DodecahedronGeometry(0.5);
            const material = new THREE.MeshPhongMaterial({ color: 0x808080 });
            const rock = new THREE.Mesh(geometry, material);
            rock.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, Math.random() * Math.PI);
            rock.scale.set(0.8 + Math.random() * 0.4, 0.8 + Math.random() * 0.4, 0.8 + Math.random() * 0.4);
            rock.castShadow = true;
            return rock;
        }

        function createCloud() {
            const cloudGroup = new THREE.Group();
            const cloudMaterial = new THREE.MeshPhongMaterial({
                color: 0xFFFFFF,
                transparent: true,
                opacity: 0.8
            });

            for (let i = 0; i < 3; i++) {
                const geometry = new THREE.SphereGeometry(0.5 + Math.random() * 0.3, 8, 8);
                const sphere = new THREE.Mesh(geometry, cloudMaterial);
                sphere.position.set((Math.random() - 0.5) * 2, (Math.random() - 0.5) * 0.5, (Math.random() - 0.5) * 1);
                cloudGroup.add(sphere);
            }

            return cloudGroup;
        }

        function createBush() {
            const bushGroup = new THREE.Group();

            // –ö—É—Å—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ñ–µ—Ä
            const bushMaterial = new THREE.MeshPhongMaterial({ color: 0x228B22 });

            for (let i = 0; i < 4; i++) {
                const geometry = new THREE.SphereGeometry(0.3 + Math.random() * 0.2, 8, 8);
                const sphere = new THREE.Mesh(geometry, bushMaterial);
                sphere.position.set((Math.random() - 0.5) * 0.6, 0.2, (Math.random() - 0.5) * 0.6);
                sphere.castShadow = true;
                bushGroup.add(sphere);
            }

            return bushGroup;
        }

        function createFlower() {
            const flowerGroup = new THREE.Group();

            // –°—Ç–µ–±–µ–ª—å
            const stemGeometry = new THREE.CylinderGeometry(0.02, 0.02, 0.4, 6);
            const stemMaterial = new THREE.MeshPhongMaterial({ color: 0x228B22 });
            const stem = new THREE.Mesh(stemGeometry, stemMaterial);
            stem.position.y = 0.2;
            flowerGroup.add(stem);

            // –¶–≤–µ—Ç–æ–∫
            const flowerColors = [0xFF1493, 0xFFFF00, 0xFF6347, 0xFF69B4, 0xFFA500, 0x9370DB];
            const flowerColor = flowerColors[Math.floor(Math.random() * flowerColors.length)];
            const flowerGeometry = new THREE.SphereGeometry(0.1, 8, 8);
            const flowerMaterial = new THREE.MeshPhongMaterial({
                color: flowerColor,
                emissive: flowerColor,
                emissiveIntensity: 0.2
            });
            const flower = new THREE.Mesh(flowerGeometry, flowerMaterial);
            flower.position.y = 0.45;
            flower.scale.set(1, 0.5, 1);
            flowerGroup.add(flower);

            return flowerGroup;
        }

        function createFence() {
            const fenceGroup = new THREE.Group();

            // –°—Ç–æ–ª–±–∏–∫–∏ –∑–∞–±–æ—Ä–∞
            for (let i = 0; i < 3; i++) {
                const postGeometry = new THREE.BoxGeometry(0.1, 0.8, 0.1);
                const postMaterial = new THREE.MeshPhongMaterial({ color: 0x8B4513 });
                const post = new THREE.Mesh(postGeometry, postMaterial);
                post.position.set(i * 0.5, 0.4, 0);
                post.castShadow = true;
                fenceGroup.add(post);
            }

            // –ü–µ—Ä–µ–∫–ª–∞–¥–∏–Ω—ã
            for (let i = 0; i < 2; i++) {
                const railGeometry = new THREE.BoxGeometry(1.2, 0.08, 0.08);
                const railMaterial = new THREE.MeshPhongMaterial({ color: 0xA0522D });
                const rail = new THREE.Mesh(railGeometry, railMaterial);
                rail.position.set(0.5, 0.3 + i * 0.3, 0);
                rail.castShadow = true;
                fenceGroup.add(rail);
            }

            return fenceGroup;
        }

        function createBird() {
            const birdGroup = new THREE.Group();

            // –¢–µ–ª–æ –ø—Ç–∏—Ü—ã
            const bodyGeometry = new THREE.SphereGeometry(0.15, 8, 8);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0x4169E1 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.scale.set(1, 0.8, 1.2);
            birdGroup.add(body);

            // –ö—Ä—ã–ª—å—è
            const wingGeometry = new THREE.BoxGeometry(0.4, 0.05, 0.2);
            const wingMaterial = new THREE.MeshPhongMaterial({ color: 0x1E90FF });

            const leftWing = new THREE.Mesh(wingGeometry, wingMaterial);
            leftWing.position.set(-0.25, 0, 0);
            birdGroup.add(leftWing);

            const rightWing = new THREE.Mesh(wingGeometry, wingMaterial);
            rightWing.position.set(0.25, 0, 0);
            birdGroup.add(rightWing);

            // –ê–Ω–∏–º–∞—Ü–∏—è –≤–∑–º–∞—Ö–æ–≤ –∫—Ä—ã–ª—å–µ–≤
            birdGroup.userData.wingAnimation = 0;

            return birdGroup;
        }

        function createGrass() {
            const grassGroup = new THREE.Group();

            // –ù–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–∞–≤–∏–Ω–æ–∫
            for (let i = 0; i < 5; i++) {
                const bladeGeometry = new THREE.BoxGeometry(0.02, 0.3, 0.02);
                const bladeMaterial = new THREE.MeshPhongMaterial({ color: 0x32CD32 });
                const blade = new THREE.Mesh(bladeGeometry, bladeMaterial);
                blade.position.set((Math.random() - 0.5) * 0.3, 0.15, (Math.random() - 0.5) * 0.3);
                blade.rotation.z = (Math.random() - 0.5) * 0.2;
                grassGroup.add(blade);
            }

            return grassGroup;
        }

        function createSign() {
            const signGroup = new THREE.Group();

            // –°—Ç–æ–ª–±
            const postGeometry = new THREE.CylinderGeometry(0.05, 0.05, 1.2, 8);
            const postMaterial = new THREE.MeshPhongMaterial({ color: 0x8B4513 });
            const post = new THREE.Mesh(postGeometry, postMaterial);
            post.position.y = 0.6;
            post.castShadow = true;
            signGroup.add(post);

            // –¢–∞–±–ª–∏—á–∫–∞
            const signGeometry = new THREE.BoxGeometry(0.6, 0.4, 0.05);
            const signMaterial = new THREE.MeshPhongMaterial({ color: 0xFFFFFF });
            const sign = new THREE.Mesh(signGeometry, signMaterial);
            sign.position.y = 1.1;
            sign.castShadow = true;
            signGroup.add(sign);

            return signGroup;
        }

        function createHouse() {
            const houseGroup = new THREE.Group();

            // –û—Å–Ω–æ–≤–∞–Ω–∏–µ –¥–æ–º–∞
            const wallGeometry = new THREE.BoxGeometry(2.5, 2, 2);
            const wallMaterial = new THREE.MeshPhongMaterial({ color: 0xD2691E });
            const walls = new THREE.Mesh(wallGeometry, wallMaterial);
            walls.position.y = 1;
            walls.castShadow = true;
            walls.receiveShadow = true;
            houseGroup.add(walls);

            // –ö—Ä—ã—à–∞
            const roofGeometry = new THREE.ConeGeometry(1.8, 1.2, 4);
            const roofMaterial = new THREE.MeshPhongMaterial({ color: 0x8B0000 });
            const roof = new THREE.Mesh(roofGeometry, roofMaterial);
            roof.position.y = 2.6;
            roof.rotation.y = Math.PI / 4;
            roof.castShadow = true;
            houseGroup.add(roof);

            // –î–≤–µ—Ä—å
            const doorGeometry = new THREE.BoxGeometry(0.6, 1.2, 0.1);
            const doorMaterial = new THREE.MeshPhongMaterial({ color: 0x654321 });
            const door = new THREE.Mesh(doorGeometry, doorMaterial);
            door.position.set(0, 0.6, 1.05);
            door.castShadow = true;
            houseGroup.add(door);

            // –û–∫–Ω–∞
            const windowGeometry = new THREE.BoxGeometry(0.5, 0.5, 0.1);
            const windowMaterial = new THREE.MeshPhongMaterial({
                color: 0x87CEEB,
                emissive: 0x4682B4,
                emissiveIntensity: 0.3
            });

            const window1 = new THREE.Mesh(windowGeometry, windowMaterial);
            window1.position.set(-0.8, 1.2, 1.05);
            houseGroup.add(window1);

            const window2 = new THREE.Mesh(windowGeometry, windowMaterial);
            window2.position.set(0.8, 1.2, 1.05);
            houseGroup.add(window2);

            // –¢—Ä—É–±–∞
            const chimneyGeometry = new THREE.BoxGeometry(0.3, 0.8, 0.3);
            const chimneyMaterial = new THREE.MeshPhongMaterial({ color: 0x8B4513 });
            const chimney = new THREE.Mesh(chimneyGeometry, chimneyMaterial);
            chimney.position.set(0.8, 2.8, 0.5);
            chimney.castShadow = true;
            houseGroup.add(chimney);

            return houseGroup;
        }

        function createHouseCat() {
            const catGroup = new THREE.Group();

            // –¢–µ–ª–æ –∫–æ—à–∫–∏
            const bodyGeometry = new THREE.BoxGeometry(0.5, 0.3, 0.7);
            const catMaterial = new THREE.MeshPhongMaterial({ color: 0xFF8C00 });
            const body = new THREE.Mesh(bodyGeometry, catMaterial);
            body.position.y = 0.25;
            body.castShadow = true;
            catGroup.add(body);

            // –ì–æ–ª–æ–≤–∞
            const headGeometry = new THREE.SphereGeometry(0.18, 16, 16);
            const head = new THREE.Mesh(headGeometry, catMaterial);
            head.position.set(0, 0.35, 0.4);
            head.castShadow = true;
            catGroup.add(head);

            // –£—à–∏
            const earGeometry = new THREE.ConeGeometry(0.08, 0.15, 4);
            const ear1 = new THREE.Mesh(earGeometry, catMaterial);
            ear1.position.set(-0.1, 0.5, 0.4);
            ear1.rotation.z = -0.3;
            catGroup.add(ear1);

            const ear2 = new THREE.Mesh(earGeometry, catMaterial);
            ear2.position.set(0.1, 0.5, 0.4);
            ear2.rotation.z = 0.3;
            catGroup.add(ear2);

            // –•–≤–æ—Å—Ç
            const tailGeometry = new THREE.CylinderGeometry(0.05, 0.03, 0.6, 8);
            const tail = new THREE.Mesh(tailGeometry, catMaterial);
            tail.position.set(0, 0.4, -0.3);
            tail.rotation.x = Math.PI / 3;
            tail.castShadow = true;
            catGroup.add(tail);

            // –õ–∞–ø—ã
            const legGeometry = new THREE.CylinderGeometry(0.04, 0.04, 0.25, 8);
            const positions = [
                [-0.15, 0.12, 0.2],
                [0.15, 0.12, 0.2],
                [-0.15, 0.12, -0.2],
                [0.15, 0.12, -0.2]
            ];

            positions.forEach(pos => {
                const leg = new THREE.Mesh(legGeometry, catMaterial);
                leg.position.set(...pos);
                leg.castShadow = true;
                catGroup.add(leg);
            });

            // –ì–ª–∞–∑–∞
            const eyeGeometry = new THREE.SphereGeometry(0.04, 8, 8);
            const eyeMaterial = new THREE.MeshPhongMaterial({
                color: 0x00FF00,
                emissive: 0x00FF00,
                emissiveIntensity: 0.5
            });

            const eye1 = new THREE.Mesh(eyeGeometry, eyeMaterial);
            eye1.position.set(-0.08, 0.38, 0.52);
            catGroup.add(eye1);

            const eye2 = new THREE.Mesh(eyeGeometry, eyeMaterial);
            eye2.position.set(0.08, 0.38, 0.52);
            catGroup.add(eye2);

            return catGroup;
        }

        function createDog() {
            const dogGroup = new THREE.Group();

            // –¢–µ–ª–æ
            const bodyGeometry = new THREE.BoxGeometry(0.8, 0.5, 0.5);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0xD2691E });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.set(0, 0.3, 0);
            body.castShadow = true;
            dogGroup.add(body);

            // –ì–æ–ª–æ–≤–∞
            const headGeometry = new THREE.BoxGeometry(0.4, 0.4, 0.35);
            const headMaterial = new THREE.MeshPhongMaterial({ color: 0xD2691E });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.set(0.5, 0.4, 0);
            head.castShadow = true;
            dogGroup.add(head);

            // –ú–æ—Ä–¥–∞
            const snoutGeometry = new THREE.BoxGeometry(0.25, 0.2, 0.25);
            const snoutMaterial = new THREE.MeshPhongMaterial({ color: 0xCD853F });
            const snout = new THREE.Mesh(snoutGeometry, snoutMaterial);
            snout.position.set(0.72, 0.35, 0);
            snout.castShadow = true;
            dogGroup.add(snout);

            // –ù–æ—Å
            const noseGeometry = new THREE.SphereGeometry(0.08, 8, 8);
            const noseMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });
            const nose = new THREE.Mesh(noseGeometry, noseMaterial);
            nose.position.set(0.84, 0.35, 0);
            nose.castShadow = true;
            dogGroup.add(nose);

            // –ì–ª–∞–∑–∞
            const eyeGeometry = new THREE.SphereGeometry(0.06, 8, 8);
            const eyeMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });

            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(0.6, 0.5, -0.12);
            dogGroup.add(leftEye);

            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.6, 0.5, 0.12);
            dogGroup.add(rightEye);

            // –£—à–∏
            const earGeometry = new THREE.BoxGeometry(0.15, 0.3, 0.1);
            const earMaterial = new THREE.MeshPhongMaterial({ color: 0xA0522D });

            const leftEar = new THREE.Mesh(earGeometry, earMaterial);
            leftEar.position.set(0.5, 0.65, -0.2);
            leftEar.rotation.z = 0.2;
            leftEar.castShadow = true;
            dogGroup.add(leftEar);

            const rightEar = new THREE.Mesh(earGeometry, earMaterial);
            rightEar.position.set(0.5, 0.65, 0.2);
            rightEar.rotation.z = -0.2;
            rightEar.castShadow = true;
            dogGroup.add(rightEar);

            // –õ–∞–ø—ã
            const legGeometry = new THREE.CylinderGeometry(0.08, 0.08, 0.35, 8);
            const legMaterial = new THREE.MeshPhongMaterial({ color: 0xD2691E });

            const frontLeftLeg = new THREE.Mesh(legGeometry, legMaterial);
            frontLeftLeg.position.set(0.3, 0.05, -0.2);
            frontLeftLeg.castShadow = true;
            dogGroup.add(frontLeftLeg);

            const frontRightLeg = new THREE.Mesh(legGeometry, legMaterial);
            frontRightLeg.position.set(0.3, 0.05, 0.2);
            frontRightLeg.castShadow = true;
            dogGroup.add(frontRightLeg);

            const backLeftLeg = new THREE.Mesh(legGeometry, legMaterial);
            backLeftLeg.position.set(-0.3, 0.05, -0.2);
            backLeftLeg.castShadow = true;
            dogGroup.add(backLeftLeg);

            const backRightLeg = new THREE.Mesh(legGeometry, legMaterial);
            backRightLeg.position.set(-0.3, 0.05, 0.2);
            backRightLeg.castShadow = true;
            dogGroup.add(backRightLeg);

            // –•–≤–æ—Å—Ç
            const tailGeometry = new THREE.CylinderGeometry(0.05, 0.08, 0.4, 8);
            const tailMaterial = new THREE.MeshPhongMaterial({ color: 0xA0522D });
            const tail = new THREE.Mesh(tailGeometry, tailMaterial);
            tail.position.set(-0.5, 0.4, 0);
            tail.rotation.z = Math.PI / 4;
            tail.castShadow = true;
            dogGroup.add(tail);

            return dogGroup;
        }

        function createCat() {
            const catGroup = new THREE.Group();

            // –¢–µ–ª–æ
            const bodyGeometry = new THREE.BoxGeometry(0.7, 0.4, 0.5);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0xFFA500 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.set(0, 0.3, 0);
            body.castShadow = true;
            catGroup.add(body);

            // –ì–æ–ª–æ–≤–∞
            const headGeometry = new THREE.SphereGeometry(0.25, 16, 16);
            const headMaterial = new THREE.MeshPhongMaterial({ color: 0xFFA500 });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.set(0.45, 0.45, 0);
            head.castShadow = true;
            catGroup.add(head);

            // –ú–æ—Ä–¥–æ—á–∫–∞
            const snoutGeometry = new THREE.SphereGeometry(0.15, 16, 16);
            const snoutMaterial = new THREE.MeshPhongMaterial({ color: 0xFFE4B5 });
            const snout = new THREE.Mesh(snoutGeometry, snoutMaterial);
            snout.position.set(0.65, 0.4, 0);
            snout.scale.set(0.8, 0.8, 0.6);
            snout.castShadow = true;
            catGroup.add(snout);

            // –ù–æ—Å
            const noseGeometry = new THREE.SphereGeometry(0.05, 8, 8);
            const noseMaterial = new THREE.MeshPhongMaterial({ color: 0xFF69B4 });
            const nose = new THREE.Mesh(noseGeometry, noseMaterial);
            nose.position.set(0.72, 0.4, 0);
            catGroup.add(nose);

            // –ì–ª–∞–∑–∞
            const eyeGeometry = new THREE.SphereGeometry(0.07, 8, 8);
            const eyeMaterial = new THREE.MeshPhongMaterial({ color: 0x90EE90 });

            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(0.58, 0.5, -0.12);
            catGroup.add(leftEye);

            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.58, 0.5, 0.12);
            catGroup.add(rightEye);

            // –ó—Ä–∞—á–∫–∏
            const pupilGeometry = new THREE.SphereGeometry(0.03, 8, 8);
            const pupilMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });

            const leftPupil = new THREE.Mesh(pupilGeometry, pupilMaterial);
            leftPupil.position.set(0.64, 0.5, -0.12);
            catGroup.add(leftPupil);

            const rightPupil = new THREE.Mesh(pupilGeometry, pupilMaterial);
            rightPupil.position.set(0.64, 0.5, 0.12);
            catGroup.add(rightPupil);

            // –£—à–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ
            const earGeometry = new THREE.ConeGeometry(0.12, 0.25, 4);
            const earMaterial = new THREE.MeshPhongMaterial({ color: 0xFFA500 });

            const leftEar = new THREE.Mesh(earGeometry, earMaterial);
            leftEar.position.set(0.45, 0.65, -0.15);
            leftEar.rotation.z = Math.PI;
            leftEar.castShadow = true;
            catGroup.add(leftEar);

            const rightEar = new THREE.Mesh(earGeometry, earMaterial);
            rightEar.position.set(0.45, 0.65, 0.15);
            rightEar.rotation.z = Math.PI;
            rightEar.castShadow = true;
            catGroup.add(rightEar);

            // –õ–∞–ø—ã
            const legGeometry = new THREE.CylinderGeometry(0.07, 0.07, 0.35, 8);
            const legMaterial = new THREE.MeshPhongMaterial({ color: 0xFFA500 });

            const frontLeftLeg = new THREE.Mesh(legGeometry, legMaterial);
            frontLeftLeg.position.set(0.25, 0.05, -0.18);
            frontLeftLeg.castShadow = true;
            catGroup.add(frontLeftLeg);

            const frontRightLeg = new THREE.Mesh(legGeometry, legMaterial);
            frontRightLeg.position.set(0.25, 0.05, 0.18);
            frontRightLeg.castShadow = true;
            catGroup.add(frontRightLeg);

            const backLeftLeg = new THREE.Mesh(legGeometry, legMaterial);
            backLeftLeg.position.set(-0.25, 0.05, -0.18);
            backLeftLeg.castShadow = true;
            catGroup.add(backLeftLeg);

            const backRightLeg = new THREE.Mesh(legGeometry, legMaterial);
            backRightLeg.position.set(-0.25, 0.05, 0.18);
            backRightLeg.castShadow = true;
            catGroup.add(backRightLeg);

            // –•–≤–æ—Å—Ç (–≤—ã—à–µ –∏ –∏–∑–æ–≥–Ω—É—Ç—ã–π)
            const tailGeometry = new THREE.CylinderGeometry(0.04, 0.06, 0.5, 8);
            const tailMaterial = new THREE.MeshPhongMaterial({ color: 0xFFA500 });
            const tail = new THREE.Mesh(tailGeometry, tailMaterial);
            tail.position.set(-0.5, 0.5, 0);
            tail.rotation.z = Math.PI / 3;
            tail.castShadow = true;
            catGroup.add(tail);

            return catGroup;
        }

        function createCube() {
            const cubeGroup = new THREE.Group();

            // –ü—Ä–æ—Å—Ç–æ –∫—É–±–∏–∫
            const geometry = new THREE.BoxGeometry(0.8, 0.8, 0.8);
            const material = new THREE.MeshPhongMaterial({ color: 0x4169E1 });
            const cube = new THREE.Mesh(geometry, material);
            cube.position.y = 0.3;
            cube.castShadow = true;
            cubeGroup.add(cube);

            // –ì–ª–∞–∑–∞
            const eyeGeometry = new THREE.SphereGeometry(0.1, 8, 8);
            const eyeMaterial = new THREE.MeshPhongMaterial({ color: 0xFFFFFF });

            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(0.42, 0.4, -0.15);
            cubeGroup.add(leftEye);

            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.42, 0.4, 0.15);
            cubeGroup.add(rightEye);

            // –ó—Ä–∞—á–∫–∏
            const pupilGeometry = new THREE.SphereGeometry(0.05, 8, 8);
            const pupilMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });

            const leftPupil = new THREE.Mesh(pupilGeometry, pupilMaterial);
            leftPupil.position.set(0.48, 0.4, -0.15);
            cubeGroup.add(leftPupil);

            const rightPupil = new THREE.Mesh(pupilGeometry, pupilMaterial);
            rightPupil.position.set(0.48, 0.4, 0.15);
            cubeGroup.add(rightPupil);

            // –£–ª—ã–±–∫–∞
            const smileGeometry = new THREE.TorusGeometry(0.15, 0.02, 8, 16, Math.PI);
            const smileMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });
            const smile = new THREE.Mesh(smileGeometry, smileMaterial);
            smile.position.set(0.42, 0.2, 0);
            smile.rotation.set(0, Math.PI / 2, 0);
            cubeGroup.add(smile);

            return cubeGroup;
        }

        function createOval() {
            const ovalGroup = new THREE.Group();

            // –¢–µ–ª–æ - —ç–ª–ª–∏–ø—Å–æ–∏–¥
            const bodyGeometry = new THREE.SphereGeometry(0.4, 16, 16);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0xFFFFFF });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 0.3;
            body.scale.set(1.2, 1, 0.8);
            body.castShadow = true;
            ovalGroup.add(body);

            // –ì–ª–∞–∑–∞
            const eyeGeometry = new THREE.SphereGeometry(0.08, 8, 8);
            const eyeMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });

            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(0.4, 0.4, -0.12);
            ovalGroup.add(leftEye);

            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.4, 0.4, 0.12);
            ovalGroup.add(rightEye);

            // –†—É–º—è–Ω–µ—Ü
            const blushGeometry = new THREE.CircleGeometry(0.08, 16);
            const blushMaterial = new THREE.MeshPhongMaterial({
                color: 0xFFB6C1,
                transparent: true,
                opacity: 0.6
            });

            const leftBlush = new THREE.Mesh(blushGeometry, blushMaterial);
            leftBlush.position.set(0.38, 0.3, -0.18);
            leftBlush.rotation.y = -Math.PI / 2;
            ovalGroup.add(leftBlush);

            const rightBlush = new THREE.Mesh(blushGeometry, blushMaterial);
            rightBlush.position.set(0.38, 0.3, 0.18);
            rightBlush.rotation.y = -Math.PI / 2;
            ovalGroup.add(rightBlush);

            // –£–ª—ã–±–∫–∞
            const smileGeometry = new THREE.TorusGeometry(0.12, 0.02, 8, 16, Math.PI);
            const smileMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });
            const smile = new THREE.Mesh(smileGeometry, smileMaterial);
            smile.position.set(0.38, 0.22, 0);
            smile.rotation.set(0, Math.PI / 2, 0);
            ovalGroup.add(smile);

            // –ú–∞–ª–µ–Ω—å–∫–∏–µ —Ä—É—á–∫–∏
            const armGeometry = new THREE.SphereGeometry(0.1, 8, 8);
            const armMaterial = new THREE.MeshPhongMaterial({ color: 0xFFFFFF });

            const leftArm = new THREE.Mesh(armGeometry, armMaterial);
            leftArm.position.set(0, 0.3, -0.35);
            leftArm.scale.set(0.6, 1, 0.6);
            leftArm.castShadow = true;
            ovalGroup.add(leftArm);

            const rightArm = new THREE.Mesh(armGeometry, armMaterial);
            rightArm.position.set(0, 0.3, 0.35);
            rightArm.scale.set(0.6, 1, 0.6);
            rightArm.castShadow = true;
            ovalGroup.add(rightArm);

            return ovalGroup;
        }

        function createFox() {
            const foxGroup = new THREE.Group();

            // –¢–µ–ª–æ
            const bodyGeometry = new THREE.BoxGeometry(0.7, 0.4, 0.5);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0xFF8C00 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.set(0, 0.3, 0);
            body.castShadow = true;
            foxGroup.add(body);

            // –ì–æ–ª–æ–≤–∞
            const headGeometry = new THREE.BoxGeometry(0.4, 0.35, 0.35);
            const headMaterial = new THREE.MeshPhongMaterial({ color: 0xFF8C00 });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.set(0.5, 0.45, 0);
            head.castShadow = true;
            foxGroup.add(head);

            // –ú–æ—Ä–¥–∞ –±–µ–ª–∞—è
            const snoutGeometry = new THREE.BoxGeometry(0.2, 0.25, 0.3);
            const snoutMaterial = new THREE.MeshPhongMaterial({ color: 0xFFFFFF });
            const snout = new THREE.Mesh(snoutGeometry, snoutMaterial);
            snout.position.set(0.68, 0.4, 0);
            snout.castShadow = true;
            foxGroup.add(snout);

            // –ù–æ—Å —á–µ—Ä–Ω—ã–π
            const noseGeometry = new THREE.SphereGeometry(0.05, 8, 8);
            const noseMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });
            const nose = new THREE.Mesh(noseGeometry, noseMaterial);
            nose.position.set(0.78, 0.42, 0);
            foxGroup.add(nose);

            // –ì–ª–∞–∑–∞
            const eyeGeometry = new THREE.SphereGeometry(0.06, 8, 8);
            const eyeMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(0.6, 0.52, -0.12);
            foxGroup.add(leftEye);
            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.6, 0.52, 0.12);
            foxGroup.add(rightEye);

            // –£—à–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ –±–æ–ª—å—à–∏–µ
            const earGeometry = new THREE.ConeGeometry(0.15, 0.3, 4);
            const earMaterial = new THREE.MeshPhongMaterial({ color: 0xFF8C00 });
            const leftEar = new THREE.Mesh(earGeometry, earMaterial);
            leftEar.position.set(0.5, 0.7, -0.15);
            leftEar.rotation.z = Math.PI;
            leftEar.castShadow = true;
            foxGroup.add(leftEar);
            const rightEar = new THREE.Mesh(earGeometry, earMaterial);
            rightEar.position.set(0.5, 0.7, 0.15);
            rightEar.rotation.z = Math.PI;
            rightEar.castShadow = true;
            foxGroup.add(rightEar);

            // –õ–∞–ø—ã
            const legGeometry = new THREE.CylinderGeometry(0.07, 0.07, 0.35, 8);
            const legMaterial = new THREE.MeshPhongMaterial({ color: 0xFF8C00 });
            for (let x of [0.25, -0.25]) {
                for (let z of [-0.18, 0.18]) {
                    const leg = new THREE.Mesh(legGeometry, legMaterial);
                    leg.position.set(x, 0.05, z);
                    leg.castShadow = true;
                    foxGroup.add(leg);
                }
            }

            // –•–≤–æ—Å—Ç –ø—É—à–∏—Å—Ç—ã–π
            const tailGeometry = new THREE.CylinderGeometry(0.06, 0.12, 0.6, 8);
            const tailMaterial = new THREE.MeshPhongMaterial({ color: 0xFF8C00 });
            const tail = new THREE.Mesh(tailGeometry, tailMaterial);
            tail.position.set(-0.6, 0.5, 0);
            tail.rotation.z = Math.PI / 2.5;
            tail.castShadow = true;
            foxGroup.add(tail);

            return foxGroup;
        }

        function createPanda() {
            const pandaGroup = new THREE.Group();

            // –¢–µ–ª–æ
            const bodyGeometry = new THREE.SphereGeometry(0.4, 16, 16);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0xFFFFFF });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.set(0, 0.35, 0);
            body.scale.set(1, 0.9, 0.8);
            body.castShadow = true;
            pandaGroup.add(body);

            // –ì–æ–ª–æ–≤–∞
            const headGeometry = new THREE.SphereGeometry(0.3, 16, 16);
            const headMaterial = new THREE.MeshPhongMaterial({ color: 0xFFFFFF });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.set(0.3, 0.5, 0);
            head.castShadow = true;
            pandaGroup.add(head);

            // –ß–µ—Ä–Ω—ã–µ –ø—è—Ç–Ω–∞ –≤–æ–∫—Ä—É–≥ –≥–ª–∞–∑
            const patchGeometry = new THREE.SphereGeometry(0.12, 16, 16);
            const patchMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });
            const leftPatch = new THREE.Mesh(patchGeometry, patchMaterial);
            leftPatch.position.set(0.42, 0.52, -0.15);
            leftPatch.scale.set(0.9, 1.2, 0.5);
            pandaGroup.add(leftPatch);
            const rightPatch = new THREE.Mesh(patchGeometry, patchMaterial);
            rightPatch.position.set(0.42, 0.52, 0.15);
            rightPatch.scale.set(0.9, 1.2, 0.5);
            pandaGroup.add(rightPatch);

            // –ì–ª–∞–∑–∞ –±–µ–ª—ã–µ
            const eyeGeometry = new THREE.SphereGeometry(0.05, 8, 8);
            const eyeMaterial = new THREE.MeshPhongMaterial({ color: 0xFFFFFF });
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(0.48, 0.52, -0.15);
            pandaGroup.add(leftEye);
            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.48, 0.52, 0.15);
            pandaGroup.add(rightEye);

            // –ó—Ä–∞—á–∫–∏
            const pupilGeometry = new THREE.SphereGeometry(0.03, 8, 8);
            const pupilMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });
            const leftPupil = new THREE.Mesh(pupilGeometry, pupilMaterial);
            leftPupil.position.set(0.52, 0.52, -0.15);
            pandaGroup.add(leftPupil);
            const rightPupil = new THREE.Mesh(pupilGeometry, pupilMaterial);
            rightPupil.position.set(0.52, 0.52, 0.15);
            pandaGroup.add(rightPupil);

            // –ù–æ—Å —á–µ—Ä–Ω—ã–π
            const noseGeometry = new THREE.SphereGeometry(0.06, 8, 8);
            const noseMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });
            const nose = new THREE.Mesh(noseGeometry, noseMaterial);
            nose.position.set(0.55, 0.42, 0);
            pandaGroup.add(nose);

            // –£—à–∏ —á–µ—Ä–Ω—ã–µ –∫—Ä—É–≥–ª—ã–µ
            const earGeometry = new THREE.SphereGeometry(0.1, 16, 16);
            const earMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });
            const leftEar = new THREE.Mesh(earGeometry, earMaterial);
            leftEar.position.set(0.3, 0.7, -0.2);
            leftEar.castShadow = true;
            pandaGroup.add(leftEar);
            const rightEar = new THREE.Mesh(earGeometry, earMaterial);
            rightEar.position.set(0.3, 0.7, 0.2);
            rightEar.castShadow = true;
            pandaGroup.add(rightEar);

            // –õ–∞–ø—ã —á–µ—Ä–Ω—ã–µ
            const legGeometry = new THREE.CylinderGeometry(0.09, 0.09, 0.35, 8);
            const legMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });
            for (let x of [0.2, -0.2]) {
                for (let z of [-0.25, 0.25]) {
                    const leg = new THREE.Mesh(legGeometry, legMaterial);
                    leg.position.set(x, 0.05, z);
                    leg.castShadow = true;
                    pandaGroup.add(leg);
                }
            }

            return pandaGroup;
        }

        function createRabbit() {
            const rabbitGroup = new THREE.Group();

            // –¢–µ–ª–æ
            const bodyGeometry = new THREE.SphereGeometry(0.35, 16, 16);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0xF5F5DC });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.set(0, 0.3, 0);
            body.scale.set(1, 1.1, 0.9);
            body.castShadow = true;
            rabbitGroup.add(body);

            // –ì–æ–ª–æ–≤–∞
            const headGeometry = new THREE.SphereGeometry(0.25, 16, 16);
            const headMaterial = new THREE.MeshPhongMaterial({ color: 0xF5F5DC });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.set(0.35, 0.5, 0);
            head.castShadow = true;
            rabbitGroup.add(head);

            // –ú–æ—Ä–¥–∞
            const snoutGeometry = new THREE.SphereGeometry(0.15, 16, 16);
            const snoutMaterial = new THREE.MeshPhongMaterial({ color: 0xFFFFFF });
            const snout = new THREE.Mesh(snoutGeometry, snoutMaterial);
            snout.position.set(0.55, 0.45, 0);
            snout.scale.set(0.8, 0.7, 0.6);
            rabbitGroup.add(snout);

            // –ù–æ—Å —Ä–æ–∑–æ–≤—ã–π
            const noseGeometry = new THREE.SphereGeometry(0.04, 8, 8);
            const noseMaterial = new THREE.MeshPhongMaterial({ color: 0xFFB6C1 });
            const nose = new THREE.Mesh(noseGeometry, noseMaterial);
            nose.position.set(0.63, 0.46, 0);
            rabbitGroup.add(nose);

            // –ì–ª–∞–∑–∞
            const eyeGeometry = new THREE.SphereGeometry(0.05, 8, 8);
            const eyeMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(0.5, 0.55, -0.12);
            rabbitGroup.add(leftEye);
            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.5, 0.55, 0.12);
            rabbitGroup.add(rightEye);

            // –î–ª–∏–Ω–Ω—ã–µ —É—à–∏
            const earGeometry = new THREE.BoxGeometry(0.1, 0.5, 0.08);
            const earMaterial = new THREE.MeshPhongMaterial({ color: 0xF5F5DC });
            const leftEar = new THREE.Mesh(earGeometry, earMaterial);
            leftEar.position.set(0.35, 0.9, -0.12);
            leftEar.rotation.z = 0.1;
            leftEar.castShadow = true;
            rabbitGroup.add(leftEar);
            const rightEar = new THREE.Mesh(earGeometry, earMaterial);
            rightEar.position.set(0.35, 0.9, 0.12);
            rightEar.rotation.z = -0.1;
            rightEar.castShadow = true;
            rabbitGroup.add(rightEar);

            // –õ–∞–ø—ã
            const legGeometry = new THREE.CylinderGeometry(0.06, 0.08, 0.25, 8);
            const legMaterial = new THREE.MeshPhongMaterial({ color: 0xF5F5DC });
            for (let x of [0.15, -0.15]) {
                for (let z of [-0.2, 0.2]) {
                    const leg = new THREE.Mesh(legGeometry, legMaterial);
                    leg.position.set(x, 0.05, z);
                    leg.castShadow = true;
                    rabbitGroup.add(leg);
                }
            }

            // –•–≤–æ—Å—Ç –ø—É—à–∏—Å—Ç—ã–π
            const tailGeometry = new THREE.SphereGeometry(0.12, 16, 16);
            const tailMaterial = new THREE.MeshPhongMaterial({ color: 0xFFFFFF });
            const tail = new THREE.Mesh(tailGeometry, tailMaterial);
            tail.position.set(-0.35, 0.3, 0);
            tail.castShadow = true;
            rabbitGroup.add(tail);

            return rabbitGroup;
        }

        function createRobot() {
            const robotGroup = new THREE.Group();

            // –¢–µ–ª–æ
            const bodyGeometry = new THREE.BoxGeometry(0.6, 0.7, 0.4);
            const bodyMaterial = new THREE.MeshPhongMaterial({
                color: 0x808080,
                metalness: 0.8,
                shininess: 100
            });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.set(0, 0.4, 0);
            body.castShadow = true;
            robotGroup.add(body);

            // –ì–æ–ª–æ–≤–∞
            const headGeometry = new THREE.BoxGeometry(0.4, 0.4, 0.35);
            const headMaterial = new THREE.MeshPhongMaterial({
                color: 0xA9A9A9,
                metalness: 0.8
            });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.set(0, 0.85, 0);
            head.castShadow = true;
            robotGroup.add(head);

            // –ê–Ω—Ç–µ–Ω–Ω–∞
            const antennaGeometry = new THREE.CylinderGeometry(0.02, 0.02, 0.15, 8);
            const antennaMaterial = new THREE.MeshPhongMaterial({ color: 0x808080 });
            const antenna = new THREE.Mesh(antennaGeometry, antennaMaterial);
            antenna.position.set(0, 1.12, 0);
            robotGroup.add(antenna);

            // –õ–∞–º–ø–æ—á–∫–∞ –Ω–∞ –∞–Ω—Ç–µ–Ω–Ω–µ
            const bulbGeometry = new THREE.SphereGeometry(0.05, 8, 8);
            const bulbMaterial = new THREE.MeshPhongMaterial({
                color: 0xFF0000,
                emissive: 0xFF0000,
                emissiveIntensity: 0.5
            });
            const bulb = new THREE.Mesh(bulbGeometry, bulbMaterial);
            bulb.position.set(0, 1.22, 0);
            robotGroup.add(bulb);

            // –ì–ª–∞–∑–∞ (—Å–≤–µ—Ç—è—â–∏–µ—Å—è)
            const eyeGeometry = new THREE.BoxGeometry(0.1, 0.08, 0.05);
            const eyeMaterial = new THREE.MeshPhongMaterial({
                color: 0x00FFFF,
                emissive: 0x00FFFF,
                emissiveIntensity: 0.7
            });
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(0.21, 0.88, -0.1);
            robotGroup.add(leftEye);
            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.21, 0.88, 0.1);
            robotGroup.add(rightEye);

            // –†–æ—Ç
            const mouthGeometry = new THREE.BoxGeometry(0.2, 0.05, 0.05);
            const mouthMaterial = new THREE.MeshPhongMaterial({ color: 0x333333 });
            const mouth = new THREE.Mesh(mouthGeometry, mouthMaterial);
            mouth.position.set(0.21, 0.75, 0);
            robotGroup.add(mouth);

            // –†—É–∫–∏
            const armGeometry = new THREE.BoxGeometry(0.15, 0.5, 0.15);
            const armMaterial = new THREE.MeshPhongMaterial({ color: 0x808080 });
            const leftArm = new THREE.Mesh(armGeometry, armMaterial);
            leftArm.position.set(0, 0.35, -0.35);
            leftArm.castShadow = true;
            robotGroup.add(leftArm);
            const rightArm = new THREE.Mesh(armGeometry, armMaterial);
            rightArm.position.set(0, 0.35, 0.35);
            rightArm.castShadow = true;
            robotGroup.add(rightArm);

            // –ù–æ–≥–∏
            const legGeometry = new THREE.BoxGeometry(0.18, 0.35, 0.18);
            const legMaterial = new THREE.MeshPhongMaterial({ color: 0x696969 });
            const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
            leftLeg.position.set(0, 0.075, -0.15);
            leftLeg.castShadow = true;
            robotGroup.add(leftLeg);
            const rightLeg = new THREE.Mesh(legGeometry, legMaterial);
            rightLeg.position.set(0, 0.075, 0.15);
            rightLeg.castShadow = true;
            robotGroup.add(rightLeg);

            return robotGroup;
        }

        function createRifle() {
            const rifleGroup = new THREE.Group();

            // –î–ª–∏–Ω–Ω—ã–π —Å—Ç–≤–æ–ª
            // –¢–æ–ª—Å—Ç—ã–π —Å—Ç–≤–æ–ª
            const barrelGeometry = new THREE.CylinderGeometry(0.05, 0.05, 0.8, 8);
            const barrelMaterial = new THREE.MeshPhongMaterial({ color: 0x1a1a1a });
            const barrel = new THREE.Mesh(barrelGeometry, barrelMaterial);
            barrel.rotation.z = Math.PI / 2;
            barrel.castShadow = true;
            mgGroup.add(barrel);

            // –ö–æ–∂—É—Ö –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è
            const coolingGeometry = new THREE.CylinderGeometry(0.07, 0.07, 0.4, 12);
            const coolingMaterial = new THREE.MeshPhongMaterial({ color: 0x333333 });
            const cooling = new THREE.Mesh(coolingGeometry, coolingMaterial);
            cooling.rotation.z = Math.PI / 2;
            cooling.position.set(0.1, 0, 0);
            cooling.castShadow = true;
            mgGroup.add(cooling);

            // –ú–∞—Å—Å–∏–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å
            const bodyGeometry = new THREE.BoxGeometry(0.5, 0.12, 0.15);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0x2a2a2a });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.set(-0.15, 0, 0);
            body.castShadow = true;
            mgGroup.add(body);

            // –ú–∞–≥–∞–∑–∏–Ω (–±–∞—Ä–∞–±–∞–Ω)
            const magGeometry = new THREE.CylinderGeometry(0.12, 0.12, 0.08, 16);
            const magMaterial = new THREE.MeshPhongMaterial({ color: 0x444444 });
            const mag = new THREE.Mesh(magGeometry, magMaterial);
            mag.position.set(-0.1, -0.1, 0);
            mag.castShadow = true;
            mgGroup.add(mag);

            // –†—É–∫–æ—è—Ç–∫–∞
            const gripGeometry = new THREE.BoxGeometry(0.08, 0.15, 0.08);
            const gripMaterial = new THREE.MeshPhongMaterial({ color: 0x654321 });
            const grip = new THREE.Mesh(gripGeometry, gripMaterial);
            grip.position.set(-0.2, -0.12, 0);
            grip.castShadow = true;
            mgGroup.add(grip);

            mgGroup.scale.set(2.0, 2.0, 2.0);
            return mgGroup;
        }


        function changeWeapon(weaponType) {
            if (selectedWeapon === weaponType) return;

            selectedWeapon = weaponType;

            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ –æ—Ä—É–∂–∏–µ
            if (currentWeapon) {
                player.remove(currentWeapon);
            }

            // –°–æ–∑–¥–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ –æ—Ä—É–∂–∏–µ (–≤ –ø—Ä–∞–≤—É—é —Ä—É–∫—É)
            currentWeapon = createWeapon(weaponType);
            currentWeapon.position.set(0.15, 0.2, -0.4);
            currentWeapon.rotation.y = 0;
            currentWeapon.rotation.z = -Math.PI / 6;
            player.add(currentWeapon);

            // –û–±–Ω–æ–≤–ª—è–µ–º UI –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–µ–ª—å–±—ã
            const weaponConfigs = {
                pistol: { name: 'üî´ –ü–∏—Å—Ç–æ–ª–µ—Ç', cooldown: 300, ammo: 30 },
                rifle: { name: 'üéØ –í–∏–Ω—Ç–æ–≤–∫–∞ (x3)', cooldown: 800, ammo: 30 },
                machinegun: { name: 'üî´üí® –ü—É–ª–µ–º—ë—Ç', cooldown: 100, ammo: 80 },
                laser: { name: '‚ö°üî´ –õ–∞–∑–µ—Ä–Ω–∞—è –ü—É—à–∫–∞', cooldown: 100, ammo: 9999 },
                gravity: { name: 'üåÄüíú –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è –ü—É—à–∫–∞', cooldown: 150, ammo: 9999 },
                sniper: { name: 'üéØüî≠ –°–Ω–∞–π–ø–µ—Ä–∫–∞', cooldown: 1000, ammo: 15 },
                laser: { name: '‚ö°üî´ –õ–∞–∑–µ—Ä', cooldown: 80, ammo: 120 },
                rocket: { name: 'üöÄüí• –†–∞–∫–µ—Ç–Ω–∏—Ü–∞', cooldown: 1500, ammo: 12 },
                crossbow: { name: 'üèπ –ê—Ä–±–∞–ª–µ—Ç', cooldown: 400, ammo: 40 },
            };

            const config = weaponConfigs[weaponType] || weaponConfigs.pistol;
            document.getElementById('weaponDisplay').textContent = '–û—Ä—É–∂–∏–µ: ' + config.name;
            shootCooldown = config.cooldown;
            maxAmmo = config.ammo;
            ammo = maxAmmo;
            updateAmmoDisplay();
        }

        function createTurret() {
            const turretGroup = new THREE.Group();

            // –ë–∞–∑–∞ —Ç—É—Ä–µ–ª–∏
            const baseGeometry = new THREE.CylinderGeometry(0.6, 0.8, 0.3, 8);
            const baseMaterial = new THREE.MeshPhongMaterial({ color: 0x555555 });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.position.y = 0.15;
            base.castShadow = true;
            turretGroup.add(base);

            // –ö–æ—Ä–ø—É—Å —Ç—É—Ä–µ–ª–∏
            const bodyGeometry = new THREE.CylinderGeometry(0.4, 0.4, 0.6, 8);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0x333333 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 0.6;
            body.castShadow = true;
            turretGroup.add(body);

            // –ì–æ–ª–æ–≤–∞ —Ç—É—Ä–µ–ª–∏ (–≤—Ä–∞—â–∞—é—â–∞—è—Å—è —á–∞—Å—Ç—å)
            const headGeometry = new THREE.BoxGeometry(0.5, 0.4, 0.5);
            const headMaterial = new THREE.MeshPhongMaterial({ color: 0x444444 });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 1.1;
            head.castShadow = true;
            turretGroup.add(head);

            // –°—Ç–≤–æ–ª
            const barrelGeometry = new THREE.CylinderGeometry(0.08, 0.08, 0.8, 8);
            const barrelMaterial = new THREE.MeshPhongMaterial({ color: 0x222222 });
            const barrel = new THREE.Mesh(barrelGeometry, barrelMaterial);
            barrel.rotation.z = Math.PI / 2;
            barrel.position.set(0.4, 1.1, 0);
            barrel.castShadow = true;
            turretGroup.add(barrel);

            // –ö—Ä–∞—Å–Ω—ã–π –æ–≥–æ–Ω—ë–∫
            const lightGeometry = new THREE.SphereGeometry(0.1, 8, 8);
            const lightMaterial = new THREE.MeshPhongMaterial({
                color: 0xff0000,
                emissive: 0xff0000,
                emissiveIntensity: 0.8
            });
            const light = new THREE.Mesh(lightGeometry, lightMaterial);
            light.position.set(0, 1.3, 0.25);
            turretGroup.add(light);

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç—É—Ä–µ–ª—å —Ä—è–¥–æ–º —Å –∏–≥—Ä–æ–∫–æ–º
            turretGroup.position.set(3, 0, 2);

            // –î–∞–Ω–Ω—ã–µ —Ç—É—Ä–µ–ª–∏
            turretGroup.userData.head = head;
            turretGroup.userData.barrel = barrel;
            turretGroup.userData.shootCooldown = 0;
            turretGroup.userData.targetRotation = 0;
            turretGroup.userData.type = 'basic';

            scene.add(turretGroup);
            turrets.push(turretGroup);
        }

        function createFireTurret() {
            const turretGroup = new THREE.Group();
            const baseGeometry = new THREE.CylinderGeometry(0.6, 0.8, 0.3, 8);
            const baseMaterial = new THREE.MeshPhongMaterial({ color: 0x8B0000 });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.position.y = 0.15;
            base.castShadow = true;
            turretGroup.add(base);
            const bodyGeometry = new THREE.CylinderGeometry(0.4, 0.4, 0.6, 8);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0xFF4500 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 0.6;
            body.castShadow = true;
            turretGroup.add(body);
            const headGeometry = new THREE.BoxGeometry(0.5, 0.4, 0.5);
            const headMaterial = new THREE.MeshPhongMaterial({ color: 0xFF6347, emissive: 0xFF4500, emissiveIntensity: 0.3 });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 1.1;
            head.castShadow = true;
            turretGroup.add(head);
            const barrelGeometry = new THREE.CylinderGeometry(0.1, 0.1, 0.8, 8);
            const barrelMaterial = new THREE.MeshPhongMaterial({ color: 0xFF8C00, emissive: 0xFF6600, emissiveIntensity: 0.4 });
            const barrel = new THREE.Mesh(barrelGeometry, barrelMaterial);
            barrel.rotation.z = Math.PI / 2;
            barrel.position.set(0.4, 1.1, 0);
            barrel.castShadow = true;
            turretGroup.add(barrel);
            const lightGeometry = new THREE.SphereGeometry(0.12, 8, 8);
            const lightMaterial = new THREE.MeshPhongMaterial({ color: 0xFF4500, emissive: 0xFF4500, emissiveIntensity: 1.0 });
            const light = new THREE.Mesh(lightGeometry, lightMaterial);
            light.position.set(0, 1.3, 0.25);
            turretGroup.add(light);
            turretGroup.position.set(-3, 0, 2);
            turretGroup.userData.head = head;
            turretGroup.userData.barrel = barrel;
            turretGroup.userData.shootCooldown = 0;
            turretGroup.userData.type = 'fire';
            scene.add(turretGroup);
            turrets.push(turretGroup);
        }

        function createLaserTurret() {
            const turretGroup = new THREE.Group();
            const baseGeometry = new THREE.CylinderGeometry(0.6, 0.8, 0.3, 8);
            const baseMaterial = new THREE.MeshPhongMaterial({ color: 0x003366 });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.position.y = 0.15;
            base.castShadow = true;
            turretGroup.add(base);
            const bodyGeometry = new THREE.CylinderGeometry(0.4, 0.4, 0.6, 8);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0x0066CC });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 0.6;
            body.castShadow = true;
            turretGroup.add(body);
            const headGeometry = new THREE.BoxGeometry(0.5, 0.4, 0.5);
            const headMaterial = new THREE.MeshPhongMaterial({ color: 0x00CCFF, emissive: 0x00AAFF, emissiveIntensity: 0.4 });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 1.1;
            head.castShadow = true;
            turretGroup.add(head);
            const barrelGeometry = new THREE.CylinderGeometry(0.06, 0.06, 0.9, 16);
            const barrelMaterial = new THREE.MeshPhongMaterial({ color: 0x00FFFF, emissive: 0x00FFFF, emissiveIntensity: 0.6 });
            const barrel = new THREE.Mesh(barrelGeometry, barrelMaterial);
            barrel.rotation.z = Math.PI / 2;
            barrel.position.set(0.45, 1.1, 0);
            barrel.castShadow = true;
            turretGroup.add(barrel);
            const lightGeometry = new THREE.SphereGeometry(0.1, 8, 8);
            const lightMaterial = new THREE.MeshPhongMaterial({ color: 0x00FFFF, emissive: 0x00FFFF, emissiveIntensity: 1.2 });
            const light = new THREE.Mesh(lightGeometry, lightMaterial);
            light.position.set(0, 1.3, 0.25);
            turretGroup.add(light);
            turretGroup.position.set(3, 0, -2);
            turretGroup.userData.head = head;
            turretGroup.userData.barrel = barrel;
            turretGroup.userData.shootCooldown = 0;
            turretGroup.userData.type = 'laser';
            scene.add(turretGroup);
            turrets.push(turretGroup);
        }

        function createRocketTurret() {
            const turretGroup = new THREE.Group();
            const baseGeometry = new THREE.CylinderGeometry(0.7, 0.9, 0.4, 6);
            const baseMaterial = new THREE.MeshPhongMaterial({ color: 0x4B0082 });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.position.y = 0.2;
            base.castShadow = true;
            turretGroup.add(base);
            const bodyGeometry = new THREE.CylinderGeometry(0.5, 0.5, 0.7, 6);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0x6A0DAD });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 0.75;
            body.castShadow = true;
            turretGroup.add(body);
            const headGeometry = new THREE.BoxGeometry(0.6, 0.5, 0.6);
            const headMaterial = new THREE.MeshPhongMaterial({ color: 0x8B00FF, emissive: 0x6A0DAD, emissiveIntensity: 0.3 });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 1.3;
            head.castShadow = true;
            turretGroup.add(head);
            const barrelGeometry = new THREE.BoxGeometry(0.8, 0.15, 0.15);
            const barrelMaterial = new THREE.MeshPhongMaterial({ color: 0x333333 });
            const barrel = new THREE.Mesh(barrelGeometry, barrelMaterial);
            barrel.position.set(0.4, 1.3, 0);
            barrel.castShadow = true;
            turretGroup.add(barrel);
            const rocketGeometry = new THREE.CylinderGeometry(0.05, 0.05, 0.3, 8);
            const rocketMaterial = new THREE.MeshPhongMaterial({ color: 0xCC00FF, emissive: 0xAA00CC, emissiveIntensity: 0.5 });
            const rocket1 = new THREE.Mesh(rocketGeometry, rocketMaterial);
            rocket1.rotation.z = Math.PI / 2;
            rocket1.position.set(0.65, 1.4, 0);
            turretGroup.add(rocket1);
            const rocket2 = new THREE.Mesh(rocketGeometry, rocketMaterial);
            rocket2.rotation.z = Math.PI / 2;
            rocket2.position.set(0.65, 1.2, 0);
            turretGroup.add(rocket2);
            const lightGeometry = new THREE.SphereGeometry(0.12, 8, 8);
            const lightMaterial = new THREE.MeshPhongMaterial({ color: 0xAA00FF, emissive: 0xAA00FF, emissiveIntensity: 1.0 });
            const light = new THREE.Mesh(lightGeometry, lightMaterial);
            light.position.set(0, 1.5, 0.3);
            turretGroup.add(light);
            turretGroup.position.set(-3, 0, -2);
            turretGroup.userData.head = head;
            turretGroup.userData.barrel = barrel;
            turretGroup.userData.shootCooldown = 0;
            turretGroup.userData.type = 'rocket';
            scene.add(turretGroup);
            turrets.push(turretGroup);
        }

        function createZombie() {
            const zombieGroup = new THREE.Group();

            // –¶–≤–µ—Ç –∑–æ–º–±–∏ - –∑–µ–ª–µ–Ω–æ–≤–∞—Ç—ã–π
            const zombieMaterial = new THREE.MeshPhongMaterial({ color: 0x4a7c4a });
            const darkMaterial = new THREE.MeshPhongMaterial({ color: 0x2d4a2d });

            // –¢–µ–ª–æ
            const bodyGeometry = new THREE.BoxGeometry(0.6, 0.8, 0.3);
            const body = new THREE.Mesh(bodyGeometry, zombieMaterial);
            body.position.y = 0.9;
            body.castShadow = true;
            zombieGroup.add(body);

            // –ì–æ–ª–æ–≤–∞
            const headGeometry = new THREE.BoxGeometry(0.4, 0.4, 0.4);
            const head = new THREE.Mesh(headGeometry, zombieMaterial);
            head.position.y = 1.5;
            head.castShadow = true;
            zombieGroup.add(head);

            // –ì–ª–∞–∑–∞ (–∫—Ä–∞—Å–Ω—ã–µ)
            const eyeGeometry = new THREE.BoxGeometry(0.08, 0.08, 0.05);
            const eyeMaterial = new THREE.MeshPhongMaterial({
                color: 0xff0000,
                emissive: 0xff0000,
                emissiveIntensity: 0.5
            });
            const eye1 = new THREE.Mesh(eyeGeometry, eyeMaterial);
            eye1.position.set(-0.1, 1.55, 0.2);
            zombieGroup.add(eye1);
            const eye2 = new THREE.Mesh(eyeGeometry, eyeMaterial);
            eye2.position.set(0.1, 1.55, 0.2);
            zombieGroup.add(eye2);

            // –†—É–∫–∏ (–≤—ã—Ç—è–Ω—É—Ç—ã –≤–ø–µ—Ä–µ–¥)
            const armGeometry = new THREE.BoxGeometry(0.15, 0.6, 0.15);
            const leftArm = new THREE.Mesh(armGeometry, darkMaterial);
            leftArm.position.set(-0.375, 1.0, 0.3);
            leftArm.rotation.x = -Math.PI / 3;
            leftArm.castShadow = true;
            zombieGroup.add(leftArm);

            const rightArm = new THREE.Mesh(armGeometry, darkMaterial);
            rightArm.position.set(0.375, 1.0, 0.3);
            rightArm.rotation.x = -Math.PI / 3;
            rightArm.castShadow = true;
            zombieGroup.add(rightArm);

            // –ù–æ–≥–∏ (–±—É–¥—É—Ç –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω—ã)
            const legGeometry = new THREE.BoxGeometry(0.2, 0.5, 0.2);
            const leftLeg = new THREE.Mesh(legGeometry, darkMaterial);
            leftLeg.position.set(-0.15, 0.25, 0);
            leftLeg.castShadow = true;
            zombieGroup.add(leftLeg);

            const rightLeg = new THREE.Mesh(legGeometry, darkMaterial);
            rightLeg.position.set(0.15, 0.25, 0);
            rightLeg.castShadow = true;
            zombieGroup.add(rightLeg);

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–æ–≥–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            zombieGroup.userData.leftLeg = leftLeg;
            zombieGroup.userData.rightLeg = rightLeg;
            zombieGroup.userData.legPhase = Math.random() * Math.PI * 2; // –°–ª—É—á–∞–π–Ω–∞—è —Ñ–∞–∑–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
            zombieGroup.userData.zombie = body; // –î–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø–æ–ø–∞–¥–∞–Ω–∏–π

            // –¢–µ–Ω—å –Ω–∞ –∑–µ–º–ª–µ
            const shadowGeometry = new THREE.CircleGeometry(0.4, 16);
            const shadowMaterial = new THREE.MeshBasicMaterial({
                color: 0x000000,
                transparent: true,
                opacity: 0.3
            });
            const shadow = new THREE.Mesh(shadowGeometry, shadowMaterial);
            shadow.rotation.x = -Math.PI / 2;
            shadow.position.y = 0.01;
            zombieGroup.add(shadow);

            zombieGroup.position.set((Math.random() - 0.5) * 5, 0, -50);

            scene.add(zombieGroup);
            obstacles.push(zombieGroup);
        }

        function createObstacle() {
            createZombie(); // –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞—ë–º –∑–æ–º–±–∏ –≤–º–µ—Å—Ç–æ –∫—É–±–∏–∫–æ–≤
        }

        function updatePlayer() {
            if (!gameActive) return;

            // –î–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ-–≤–ø—Ä–∞–≤–æ
            if (keys['ArrowLeft'] && player.position.x > -4) {
                player.position.x -= playerSpeed;
                // –í —Ä–µ–∂–∏–º–µ –æ—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ –ª–∏—Ü–∞ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                if (cameraMode === 'thirdPerson') {
                    player.rotation.y = -Math.PI; // –ü–æ–≤–æ—Ä–æ—Ç –≤–ª–µ–≤–æ
                }
            }
            if (keys['ArrowRight'] && player.position.x < 4) {
                player.position.x += playerSpeed;
                // –í —Ä–µ–∂–∏–º–µ –æ—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ –ª–∏—Ü–∞ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                if (cameraMode === 'thirdPerson') {
                    player.rotation.y = 0; // –ü–æ–≤–æ—Ä–æ—Ç –≤–ø—Ä–∞–≤–æ
                }
            }
            // –í–æ–∑–≤—Ä–∞—Ç –≤ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ —Ç—Ä–µ—Ç—å–µ–≥–æ –ª–∏—Ü–∞
            if (cameraMode === 'thirdPerson' && !keys['ArrowLeft'] && !keys['ArrowRight']) {
                player.rotation.y = -Math.PI / 2; // –°–º–æ—Ç—Ä–∏—Ç –≤–ø–µ—Ä–µ–¥
            }


            // –ü—Ä—ã–∂–æ–∫ –Ω–∞ –ø—Ä–æ–±–µ–ª
            if (keys['Space'] && !isJumping) {
                playerVelocityY = jumpPower;
                isJumping = true;
            }

            // –°–º–µ–Ω–∞ –æ—Ä—É–∂–∏—è
            if (keys['Digit1']) {
                changeWeapon('pistol');
            }
            if (keys['Digit2']) {
                changeWeapon('rifle');
            }
            if (keys['Digit3'] && unlockedWeapons.includes('laser')) {
                changeWeapon('laser');
            if (keys['Digit4'] && unlockedWeapons.includes('gravity')) {                changeWeapon('gravity');            }
            if (keys['Digit4'] && unlockedWeapons.includes('gravity')) {                changeWeapon('gravity');            }
            if (keys['Digit4'] && unlockedWeapons.includes('gravity')) {                changeWeapon('gravity');            }
            }
            if (keys['Digit5'] && ownedWeapons.includes('sniper')) {
                changeWeapon('sniper');
            }
            if (keys['Digit6'] && ownedWeapons.includes('laser')) {
                changeWeapon('laser');
            }
            if (keys['Digit7'] && ownedWeapons.includes('rocket')) {
                changeWeapon('rocket');
            }
            if (keys['Digit8'] && ownedWeapons.includes('crossbow')) {
                changeWeapon('crossbow');
            }
            if (keys['Digit9'] && ownedWeapons.includes('plasma')) {
                changeWeapon('plasma');
            }

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∫–∞–º–µ—Ä—ã –Ω–∞ ENTER
            if (keys['Enter']) {
                keys['Enter'] = false; // –ß—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–ª–æ—Å—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
                if (cameraMode === 'firstPerson') {
                    cameraMode = 'thirdPerson';
                    document.getElementById('crosshair').style.display = 'none';
                    document.getElementById('cameraMode').textContent = '–í–∏–¥: –û—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ –ª–∏—Ü–∞';
                } else {
                    cameraMode = 'firstPerson';
                    document.getElementById('crosshair').style.display = 'block';
                    document.getElementById('cameraMode').textContent = '–í–∏–¥: –û—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞';
                }
            }


            // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞ –Ω–∞ –∫–ª–∞–≤–∏—à—É B
            if (keys['KeyB']) {
                keys['KeyB'] = false;
                openShop();
            }
            // –°—Ç—Ä–µ–ª—å–±–∞ –Ω–∞ –∫–ª–∞–≤–∏—à—É W
            if ((keys['KeyW'] || keys['KeyW'.toLowerCase()]) && canShoot && !isBurstFiring) {
                if (selectedWeapon === 'rifle') {
                    shootBurst();
                } else if (selectedWeapon === 'shotgun') {
                    shootShotgun();
                    canShoot = false;
                    setTimeout(() => { canShoot = true; }, shootCooldown);
                } else if (selectedWeapon === 'rocket') {
                    shootRocket();
                    canShoot = false;
                    setTimeout(() => { canShoot = true; }, shootCooldown);
                } else if (selectedWeapon === 'plasma') {
                    shootPlasma();
                    canShoot = false;
                    setTimeout(() => { canShoot = true; }, shootCooldown);
                } else {
                    // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ: –ø–∏—Å—Ç–æ–ª–µ—Ç, –ø—É–ª–µ–º—ë—Ç, —Å–Ω–∞–π–ø–µ—Ä–∫–∞, –ª–∞–∑–µ—Ä, –∞—Ä–±–∞–ª–µ—Ç
                    shoot();
                    canShoot = false;
                    setTimeout(() => { canShoot = true; }, shootCooldown);
                }
            }

            playerVelocityY += gravity;
            player.position.y += playerVelocityY;

            if (player.position.y <= 0.5) {
                player.position.y = 0.5;
                playerVelocityY = 0;
                isJumping = false;
            }
        }

        function shoot() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–∞—Ç—Ä–æ–Ω–æ–≤
            if (ammo <= 0) {
                return;
            }
            // –õ–∞–∑–µ—Ä–Ω–∞—è –ø—É—à–∫–∞ –Ω–µ —Ä–∞—Å—Ö–æ–¥—É–µ—Ç –ø–∞—Ç—Ä–æ–Ω—ã
            if (selectedWeapon !== 'laser' && selectedWeapon !== 'gravity') {
                ammo--;
                updateAmmoDisplay();
            }


            // –°–æ–∑–¥–∞–µ–º –ø—É–ª—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ—Ä—É–∂–∏—è
            let bulletGeometry, bulletMaterial;

            if (selectedWeapon === 'laser') {
                // –õ–∞–∑–µ—Ä–Ω—ã–π –ª—É—á - –∑–µ–ª–µ–Ω—ã–π —Å–≤–µ—Ç—è—â–∏–π—Å—è —Ü–∏–ª–∏–Ω–¥—Ä
                bulletGeometry = new THREE.CylinderGeometry(0.08, 0.08, 0.6, 8);
                bulletMaterial = new THREE.MeshPhongMaterial({
                    color: 0x00FF00,
                    emissive: 0x00FF00,
                    emissiveIntensity: 1.2,
                    transparent: true,
                    opacity: 0.9
                });
            } else if (selectedWeapon === 'gravity') {
                // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ñ–µ—Ä–∞ - —Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
                bulletGeometry = new THREE.SphereGeometry(0.35, 16, 16);
                bulletMaterial = new THREE.MeshPhongMaterial({
                    color: 0x9400D3,
                    emissive: 0xFF00FF,
                    emissiveIntensity: 1.5,
                    transparent: true,
                    opacity: 0.8
                });
            } else {
                // –û–±—ã—á–Ω–∞—è –ø—É–ª—è
                bulletGeometry = new THREE.SphereGeometry(0.25, 12, 12);
                bulletMaterial = new THREE.MeshPhongMaterial({
                    color: 0xFF4500,
                    emissive: 0xFF4500,
                    emissiveIntensity: 0.8
                });
            }

            // –°–æ–∑–¥–∞–µ–º mesh –ø—É–ª–∏
            const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);

            // –ü—É–ª—è –≤—ã–ª–µ—Ç–∞–µ—Ç –∏–∑ –ø–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞
            if (cameraMode === 'firstPerson') {
                // –û—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞ - –∏–∑ –∫–∞–º–µ—Ä—ã
                bullet.position.copy(camera.position);
            } else {
                // –û—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ –ª–∏—Ü–∞ - –∏–∑ –∏–≥—Ä–æ–∫–∞
                bullet.position.set(player.position.x, player.position.y + 0.5, player.position.z);
            }

            // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É–ª–∏
            const direction = new THREE.Vector3();
            if (cameraMode === 'firstPerson') {
                // –û—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞ - –∫—É–¥–∞ —Å–º–æ—Ç—Ä–∏—Ç –∫–∞–º–µ—Ä–∞
                camera.getWorldDirection(direction);
            } else {
                // –û—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ –ª–∏—Ü–∞ - –æ—Ç –∏–≥—Ä–æ–∫–∞ –∫ —Ü–µ–ª–∏ –∞–≤—Ç–æ–ø—Ä–∏—Ü–µ–ª–∏–≤–∞–Ω–∏—è
                direction.subVectors(cameraLookTarget, bullet.position).normalize();
            }
            bullet.userData.direction = direction;

            bullet.castShadow = true;
            scene.add(bullet);
            bullets.push(bullet);
        }

        function shootBurst() {
            // –°—Ç—Ä–µ–ª—è–µ–º –æ—á–µ—Ä–µ–¥—å—é –∏–∑ 3 –≤—ã—Å—Ç—Ä–µ–ª–æ–≤ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
            if (ammo <= 0) {
                return;
            }

            isBurstFiring = true;
            canShoot = false;
            burstCount = 0;

            const burstInterval = setInterval(() => {
                if (burstCount >= burstMax || ammo <= 0) {
                    clearInterval(burstInterval);
                    isBurstFiring = false;
                    setTimeout(() => {
                        canShoot = true;
                    }, shootCooldown);
                    return;
                }

                shoot();
                burstCount++;
            }, 100); // 100–º—Å –º–µ–∂–¥—É –≤—ã—Å—Ç—Ä–µ–ª–∞–º–∏ –≤ –æ—á–µ—Ä–µ–¥–∏
        }

        function shootShotgun() {
            // –î—Ä–æ–±–æ–≤–∏–∫ —Å—Ç—Ä–µ–ª—è–µ—Ç –¥—Ä–æ–±—å—é (–º–Ω–æ–∂–µ—Å—Ç–≤–æ –º–µ–ª–∫–∏—Ö –ø—É–ª—å —Å —Ä–∞–∑–±—Ä–æ—Å–æ–º)
            if (ammo <= 0) {
                return;
            }

            const pelletsCount = 15; // –ë–æ–ª—å—à–µ –¥—Ä–æ–±–∏
            const spreadAngle = 0.25; // –†–∞–∑–±—Ä–æ—Å –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö (~30 –≥—Ä–∞–¥—É—Å–æ–≤ –∫–æ–Ω—É—Å)
            const ammoUsed = Math.min(1, ammo); // –î—Ä–æ–±–æ–≤–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 1 –ø–∞—Ç—Ä–æ–Ω

            ammo -= ammoUsed;

            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∑–≥–ª—è–¥–∞ –∫–∞–º–µ—Ä—ã
            const cameraDirection = new THREE.Vector3();
            camera.getWorldDirection(cameraDirection);

            for (let i = 0; i < pelletsCount; i++) {
                const bulletGeometry = new THREE.SphereGeometry(0.1, 8, 8); // –ú–µ–ª–∫–∞—è –¥—Ä–æ–±—å
                const bulletMaterial = new THREE.MeshPhongMaterial({
                    color: 0xFF6600,
                    emissive: 0xFF4500,
                    emissiveIntensity: 0.8
                });
                const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);

                // –ü—É–ª—è –≤—ã–ª–µ—Ç–∞–µ—Ç –∏–∑ –ø–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞
                if (cameraMode === 'firstPerson') {
                    bullet.position.copy(camera.position);
                } else {
                    bullet.position.set(player.position.x, player.position.y + 0.5, player.position.z);
                }

                // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - –≤–ø–µ—Ä–µ–¥ –æ—Ç –∫–∞–º–µ—Ä—ã —Å —Å–ª—É—á–∞–π–Ω—ã–º —Ä–∞–∑–±—Ä–æ—Å–æ–º
                const direction = cameraDirection.clone();

                // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ä–∞–∑–±—Ä–æ—Å
                direction.x += (Math.random() - 0.5) * spreadAngle;
                direction.y += (Math.random() - 0.5) * spreadAngle;
                direction.z += (Math.random() - 0.5) * spreadAngle * 0.5; // –ú–µ–Ω—å—à–µ –ø–æ Z

                direction.normalize();
                bullet.userData.direction = direction;

                bullet.castShadow = true;
                scene.add(bullet);
                bullets.push(bullet);
            }

            updateAmmoDisplay();
        }

        function shootRocket() {
            // –†–∞–∫–µ—Ç–Ω–∏—Ü–∞ —Å—Ç—Ä–µ–ª—è–µ—Ç –±–æ–ª—å—à–æ–π –≤–∑—Ä—ã–≤–Ω–æ–π —Ä–∞–∫–µ—Ç–æ–π
            if (ammo <= 0) return;

            ammo--;
            updateAmmoDisplay();

            const bulletGeometry = new THREE.CylinderGeometry(0.15, 0.2, 0.4, 8);
            const bulletMaterial = new THREE.MeshPhongMaterial({
                color: 0xFF0000,
                emissive: 0xFF4500,
                emissiveIntensity: 0.9
            });
            const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);
            bullet.rotation.z = Math.PI / 2;

            if (cameraMode === 'firstPerson') {
                bullet.position.copy(camera.position);
            } else {
                bullet.position.set(player.position.x, player.position.y + 0.5, player.position.z);
            }

            const direction = new THREE.Vector3();
            camera.getWorldDirection(direction);
            bullet.userData.direction = direction;
            bullet.userData.isRocket = true; // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è —Ä–∞–∫–µ—Ç—ã

            bullet.castShadow = true;
            scene.add(bullet);
            bullets.push(bullet);
        }

        function shootPlasma() {
            // –ü–ª–∞–∑–º–µ–Ω–Ω–∞—è –ø—É—à–∫–∞ —Å—Ç—Ä–µ–ª—è–µ—Ç —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–º–∏ —à–∞—Ä–∞–º–∏
            if (ammo <= 0) return;

            ammo--;
            updateAmmoDisplay();

            const bulletGeometry = new THREE.SphereGeometry(0.3, 16, 16);
            const bulletMaterial = new THREE.MeshPhongMaterial({
                color: 0xFF00FF,
                emissive: 0xFF00FF,
                emissiveIntensity: 1.0,
                transparent: true,
                opacity: 0.8
            });
            const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);

            if (cameraMode === 'firstPerson') {
                bullet.position.copy(camera.position);
            } else {
                bullet.position.set(player.position.x, player.position.y + 0.5, player.position.z);
            }

            const direction = new THREE.Vector3();
            camera.getWorldDirection(direction);
            bullet.userData.direction = direction;
            bullet.userData.isPlasma = true; // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥

            bullet.castShadow = true;
            scene.add(bullet);
            bullets.push(bullet);
        }

        function updateAmmoDisplay() {
            const ammoColor = ammo < 10 ? 'red' : (ammo < 30 ? 'orange' : 'yellow');
            document.getElementById('ammoDisplay').innerHTML = `<span style="color: ${ammoColor}">–ü–∞—Ç—Ä–æ–Ω—ã: ${ammo} / ${maxAmmo}</span>`;
        }

        function updateBullets() {
            if (!gameActive) return;

            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];

                // –ü—É–ª–∏ –ª–µ—Ç—è—Ç –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∫–∞–º–µ—Ä—ã (–∞–≤—Ç–æ–ø—Ä–∏—Ü–µ–ª–∏–≤–∞–Ω–∏–µ)
                if (bullet.userData.direction) {
                    bullet.position.x += bullet.userData.direction.x * bulletSpeed;
                    bullet.position.y += bullet.userData.direction.y * bulletSpeed;
                    bullet.position.z += bullet.userData.direction.z * bulletSpeed;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
                for (let j = obstacles.length - 1; j >= 0; j--) {
                    const obstacleGroup = obstacles[j];
                    const cube = obstacleGroup.userData.cube;
                    if (!cube) continue;

                    const cubeWorldPos = new THREE.Vector3();
                    cube.getWorldPosition(cubeWorldPos);

                    const distance = bullet.position.distanceTo(cubeWorldPos);
                    if (distance < 1.5) {
                        // –ü–æ–ø–∞–¥–∞–Ω–∏–µ!
                        scene.remove(obstacleGroup);
                        obstacles.splice(j, 1);
                        scene.remove(bullet);
                        bullets.splice(i, 1);
                        score += 10;
                        coins += 5;
                        updateCoinsDisplay();
                        localStorage.setItem('cubeGameCoins', coins);
                        updateLevel();
                        updateScoreDisplay();
                        break;
                    }
                }

                // –£–¥–∞–ª—è–µ–º –ø—É–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–ª–µ—Ç–µ–ª–∏ –¥–∞–ª–µ–∫–æ
                const distanceFromPlayer = bullet.position.distanceTo(player.position);
                if (distanceFromPlayer > 60) {
                    scene.remove(bullet);
                    bullets.splice(i, 1);
                }
            }
        }

        function updateScoreDisplay() {
            const heartsDisplay = '‚ù§Ô∏è'.repeat(lives);
            document.getElementById('score').textContent = '–°—á—ë—Ç: ' + score + ' | –†–µ–∫–æ—Ä–¥: ' + highScore + ' | –£—Ä–æ–≤–µ–Ω—å: ' + level + ' | –ñ–∏–∑–Ω–∏: ' + heartsDisplay;
        }

        function loseLife() {
            lives--;
            updateScoreDisplay();

            // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ—Ç–µ—Ä–∏ –∂–∏–∑–Ω–∏ - –∫—Ä–∞—Å–Ω–∞—è –≤—Å–ø—ã—à–∫–∞
            scene.background = new THREE.Color(0xFF0000);
            setTimeout(() => {
                scene.background = new THREE.Color(0x87ceeb);
            }, 200);

            if (lives <= 0) {
                gameOver();
            }
        }

        function updateLevel() {
            const newLevel = Math.floor(score / 50) + 1;
            if (newLevel > level) {
                level = newLevel;
                obstacleSpeed = 0.02 + (level - 1) * 0.005; // –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–æ–º–±–∏
                spawnRate = 0.03 + (level - 1) * 0.01; // –ú–Ω–æ–≥–æ –∑–æ–º–±–∏

                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞—Ç—Ä–æ–Ω—ã –∫–∞–∂–¥—ã–µ 5 —É—Ä–æ–≤–Ω–µ–π
                if (level % 5 === 0) {
                    ammo = maxAmmo;
                    updateAmmoDisplay();
                }
                updateScoreDisplay();

                // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è
                scene.background = new THREE.Color(Math.random() * 0x666666 + 0x6699bb);
                setTimeout(() => {
                    scene.background = new THREE.Color(0x87ceeb);
                }, 300);

                // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ª–∞–∑–µ—Ä–Ω–æ–π –ø—É—à–∫–∏ –Ω–∞ 20 —É—Ä–æ–≤–Ω–µ
                if (level === 20 && !unlockedWeapons.includes('laser')) {
                    unlockedWeapons.push('laser');
                    localStorage.setItem('cubeGameUnlockedWeapons', JSON.stringify(unlockedWeapons));

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    gameActive = false;
                    const notification = document.createElement('div');
                    notification.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 60px; border-radius: 20px; font-size: 32px; font-weight: bold; z-index: 500; text-align: center; border: 5px solid gold; box-shadow: 0 0 50px rgba(102, 126, 234, 0.8);';
                    notification.innerHTML = 'üéâ –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! üéâ<br><br>üî´‚ö° –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù–ê –õ–ê–ó–ï–†–ù–ê–Ø –ü–£–®–ö–ê! ‚ö°üî´<br><br>–ù–∞–∂–º–∏—Ç–µ 3 –¥–ª—è –≤—ã–±–æ—Ä–∞<br><br><span style="font-size: 20px; color: #FFD700;">–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –ø–∞—Ç—Ä–æ–Ω—ã ‚Ä¢ –ë—ã—Å—Ç—Ä–∞—è —Å—Ç—Ä–µ–ª—å–±–∞</span>';
                    document.body.appendChild(notification);

                    setTimeout(() => {
                        document.body.removeChild(notification);
                        gameActive = true;
                    }, 5000);
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å
                if (level > maxLevelReached) {
                    maxLevelReached = level;
                    localStorage.setItem('cubeGameMaxLevel', maxLevelReached);
                }

                // –ö–∞–∂–¥—ã–µ 10 —É—Ä–æ–≤–Ω–µ–π - –±–æ–ª—å—à–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –∏ –º–∞–≥–∞–∑–∏–Ω
                if (level % 10 === 0) {
                    coins += 300;
                    updateCoinsDisplay();
                    gameActive = false;
                    setTimeout(() => {
                        openShop(true);
                    }, 500);
                }
            }
        }

        function updateObstacles() {
            if (!gameActive) return;

            if (Math.random() < spawnRate) {
                createObstacle();
            }

            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obstacleGroup = obstacles[i];
                obstacleGroup.position.z += obstacleSpeed;

                // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–æ–≥ –∑–æ–º–±–∏
                const leftLeg = obstacleGroup.userData.leftLeg;
                const rightLeg = obstacleGroup.userData.rightLeg;
                if (leftLeg && rightLeg) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∞–∑—É –∞–Ω–∏–º–∞—Ü–∏–∏
                    obstacleGroup.userData.legPhase += 0.1;

                    // –ö–∞—á–∞–Ω–∏–µ –Ω–æ–≥ –≤–ø–µ—Ä—ë–¥-–Ω–∞–∑–∞–¥
                    const swingAngle = Math.sin(obstacleGroup.userData.legPhase) * 0.3;
                    leftLeg.rotation.x = swingAngle;
                    rightLeg.rotation.x = -swingAngle;
                }

                // –í—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ –∫—É–±–∏–∫ –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø—ã (–¥–ª—è —Å—Ç–∞—Ä—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤)
                const cube = obstacleGroup.userData.cube;
                if (cube && obstacleGroup.rotationSpeed) {
                    cube.rotation.x += obstacleGroup.rotationSpeed.x;
                    cube.rotation.y += obstacleGroup.rotationSpeed.y;
                    cube.rotation.z += obstacleGroup.rotationSpeed.z;
                }

                // –î–ª—è –∑–æ–º–±–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–ª–æ –¥–ª—è –∫–æ–ª–ª–∏–∑–∏–π
                const zombie = obstacleGroup.userData.zombie;
                if (zombie && !obstacleGroup.userData.cube) {
                    obstacleGroup.userData.cube = zombie;
                }

                if (checkCollision(player, obstacleGroup)) {
                    scene.remove(obstacleGroup);
                    obstacles.splice(i, 1);
                    score += 10;
                    coins += 5;
                    updateCoinsDisplay();
                    localStorage.setItem('cubeGameCoins', coins);
                    updateLevel();
                    updateScoreDisplay();
                } else if (obstacleGroup.position.z > 10) {
                    scene.remove(obstacleGroup);
                    obstacles.splice(i, 1);
                    loseLife();
                }
            }
        }

        function checkCollision(obj1, obstacleGroup) {
            // –ü–æ–ª—É—á–∞–µ–º –º–∏—Ä–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é –∫—É–±–∏–∫–∞ –≤ –≥—Ä—É–ø–ø–µ
            const cube = obstacleGroup.userData.cube;
            if (!cube) return false;

            const cubeWorldPos = new THREE.Vector3();
            cube.getWorldPosition(cubeWorldPos);

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ—Ä–¥
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('cubeGameHighScore', highScore);
            }
            const distance = obj1.position.distanceTo(cubeWorldPos);
            return distance < 1.2;
        }

        function gameOver() {
            gameActive = false;
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ—Ä–¥
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('cubeGameHighScore', highScore);
            }
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalLevel').textContent = level;
            document.getElementById('finalHighScore').textContent = highScore;
            document.getElementById('gameOver').style.display = 'block';
            document.getElementById('crosshair').style.display = 'none';
            document.getElementById('cameraMode').style.display = 'none';
        }


        function updateCoinsDisplay() {
            document.getElementById('coinsDisplay').textContent = 'üí∞ –ú–æ–Ω–µ—Ç—ã: ' + coins;
        }

        function openShop() {
            gameActive = false;
            document.getElementById('shopMenu').style.display = 'block';
            document.getElementById('shopCoins').textContent = coins;
        }

        function closeShop() {
            document.getElementById('shopMenu').style.display = 'none';
            document.getElementById('shopMessage').style.display = 'none';
            document.getElementById('score').style.display = 'block';
            document.getElementById('instructions').style.display = 'block';
            document.getElementById('weaponDisplay').style.display = 'block';
            document.getElementById('ammoDisplay').style.display = 'block';
            document.getElementById('cameraMode').style.display = 'block';
            document.getElementById('coinsDisplay').style.display = 'block';
            document.getElementById('openShopBtn').style.display = 'block';
            document.getElementById('openItemsShopBtn').style.display = 'block';
            if (cameraMode === 'firstPerson') {
                document.getElementById('crosshair').style.display = 'block';
            }
            gameActive = true;
        }

        function showShopMessage(message, isSuccess) {
            const msgElement = document.getElementById('shopMessage');
            msgElement.textContent = message;
            msgElement.style.display = 'block';
            msgElement.style.backgroundColor = isSuccess ? 'rgba(76, 175, 80, 0.8)' : 'rgba(244, 67, 54, 0.8)';
            msgElement.style.color = 'white';

            setTimeout(() => {
                msgElement.style.display = 'none';
            }, 2000);
        }

        function buyAmmo(amount, cost) {
            if (coins >= cost) {
                coins -= cost;
                ammo += amount;
                localStorage.setItem('cubeGameCoins', coins);
                updateCoinsDisplay();
                updateAmmoDisplay();
                document.getElementById('shopCoins').textContent = coins;
                showShopMessage('‚úÖ –ö—É–ø–ª–µ–Ω–æ +' + amount + ' –ø–∞—Ç—Ä–æ–Ω–æ–≤!', true);
            } else {
                const need = cost - coins;
                showShopMessage('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç! –ù—É–∂–Ω–æ –µ—â–µ: ' + need + ' üí∞', false);
            }
        }
        function restartGame() {
            obstacles.forEach(obstacle => scene.remove(obstacle));
            obstacles = [];
            bullets.forEach(bullet => scene.remove(bullet));
            bullets = [];
            score = 0;
            level = 1;
            lives = 3;
            ammo = maxAmmo;
            obstacleSpeed = 0.02; // –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–æ–º–±–∏
            spawnRate = 0.03; // –ú–Ω–æ–≥–æ –∑–æ–º–±–∏
            canShoot = true;
            isBurstFiring = false;
            burstCount = 0;
            cameraMode = 'firstPerson';
            updateScoreDisplay();
            updateAmmoDisplay();
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('crosshair').style.display = 'block';
            document.getElementById('cameraMode').style.display = 'block';
            document.getElementById('cameraMode').textContent = '–í–∏–¥: –û—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞';
            player.position.set(0, 0.5, 0);
            player.rotation.set(0, -Math.PI / 2, 0); // –°–º–æ—Ç—Ä–∏—Ç –Ω–∞ –∫—É–±–∏–∫–∏
            playerVelocityY = 0;
            isJumping = false;
            gameActive = true;
        }

        function returnToSkinMenu() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }

            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä—É
            gameActive = false;

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥—Ä—ã
            score = 0;
            level = 1;
            lives = 3;
            ammo = maxAmmo;
            obstacleSpeed = 0.05;
            spawnRate = 0.01;
            playerVelocityY = 0;
            isJumping = false;
            canShoot = true;
            isBurstFiring = false;
            burstCount = 0;
            selectedSkin = null;
            cameraMode = 'firstPerson';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Å–∫–∏–Ω–∞
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('score').style.display = 'none';
            document.getElementById('instructions').style.display = 'none';
            document.getElementById('weaponDisplay').style.display = 'none';
            document.getElementById('ammoDisplay').style.display = 'none';
            document.getElementById('crosshair').style.display = 'none';
            document.getElementById('cameraMode').style.display = 'none';
            document.getElementById('skinMenu').style.display = 'block';
        }

        function findNearestObstacle() {
            let nearest = null;
            let bestScore = Infinity;

            obstacles.forEach(obstacleGroup => {
                const cube = obstacleGroup.userData.cube;
                if (!cube) return;

                const cubeWorldPos = new THREE.Vector3();
                cube.getWorldPosition(cubeWorldPos);

                // –†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫—É–±–∏–∫–∏ –≤–ø–µ—Ä–µ–¥–∏ –∏–≥—Ä–æ–∫–∞
                if (cubeWorldPos.z < player.position.z) {
                    const distance = player.position.distanceTo(cubeWorldPos);

                    // –í–µ–∫—Ç–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç –∏–≥—Ä–æ–∫–∞ –∫ –∫—É–±–∏–∫—É
                    const directionToCube = new THREE.Vector3()
                        .subVectors(cubeWorldPos, player.position)
                        .normalize();

                    // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∑–≥–ª—è–¥–∞ (–≤–ø–µ—Ä–µ–¥ –ø–æ -Z)
                    const forward = new THREE.Vector3(0, 0, -1);

                    // –£–≥–ª–æ–≤–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (—á–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º –ª—É—á—à–µ)
                    const angle = Math.acos(directionToCube.dot(forward));

                    // –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞: —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ + —É–≥–æ–ª (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–º —Ü–µ–ª—è–º)
                    const score = distance + angle * 5;

                    if (score < bestScore) {
                        bestScore = score;
                        nearest = cubeWorldPos;
                    }
                }
            });

            return nearest;
        }

        function updateCamera() {
            if (!gameActive) return;

            if (cameraMode === 'firstPerson') {
                // –í–∏–¥ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞ - –∫–∞–º–µ—Ä–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –≥–ª–∞–∑
                camera.position.x = player.position.x;
                camera.position.y = player.position.y + 0.7;
                camera.position.z = player.position.z;

                // –ê–≤—Ç–æ–ø—Ä–∏—Ü–µ–ª–∏–≤–∞–Ω–∏–µ –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–π –∫—É–±–∏–∫ —Å –ø–ª–∞–≤–Ω—ã–º –ø–µ—Ä–µ—Ö–æ–¥–æ–º
                const nearestCube = findNearestObstacle();
                let targetLook;
                if (nearestCube) {
                    targetLook = nearestCube.clone();
                } else {
                    // –ï—Å–ª–∏ –∫—É–±–∏–∫–æ–≤ –Ω–µ—Ç, —Å–º–æ—Ç—Ä–∏–º –≤–ø–µ—Ä–µ–¥
                    targetLook = new THREE.Vector3(player.position.x, player.position.y + 0.7, player.position.z - 10);
                }

                // –ü–ª–∞–≤–Ω–æ–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞ —Ü–µ–ª—å—é (lerp)
                cameraLookTarget.lerp(targetLook, 0.15);
                camera.lookAt(cameraLookTarget);
            } else {
                // –í–∏–¥ –æ—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ –ª–∏—Ü–∞ - –∫–∞–º–µ—Ä–∞ –ø–æ–∑–∞–¥–∏ –∏ –≤—ã—à–µ –∏–≥—Ä–æ–∫–∞
                camera.position.x = player.position.x;
                camera.position.y = player.position.y + 5; // –í—ã—à–µ –∏–≥—Ä–æ–∫–∞
                camera.position.z = player.position.z + 8; // –ü–æ–∑–∞–¥–∏ –∏–≥—Ä–æ–∫–∞

                // –ê–≤—Ç–æ–ø—Ä–∏—Ü–µ–ª–∏–≤–∞–Ω–∏–µ –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–π –∫—É–±–∏–∫ –¥–ª—è —Å—Ç—Ä–µ–ª—å–±—ã
                const nearestCube = findNearestObstacle();
                let targetLook;
                if (nearestCube) {
                    targetLook = nearestCube.clone();
                } else {
                    // –ï—Å–ª–∏ –∫—É–±–∏–∫–æ–≤ –Ω–µ—Ç, —Å–º–æ—Ç—Ä–∏–º –Ω–∞ –∏–≥—Ä–æ–∫–∞ –∏ –≤–ø–µ—Ä–µ–¥
                    targetLook = new THREE.Vector3(player.position.x, player.position.y, player.position.z - 10);
                }

                // –ü–ª–∞–≤–Ω–æ–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞ —Ü–µ–ª—å—é
                cameraLookTarget.lerp(targetLook, 0.15);
                camera.lookAt(cameraLookTarget);
            }
        }

        function updateTurrets() {
            if (!gameActive) return;

            turrets.forEach(turret => {
                // –£–º–µ–Ω—å—à–∞–µ–º –∫—É–ª–¥–∞—É–Ω
                if (turret.userData.shootCooldown > 0) {
                    turret.userData.shootCooldown--;
                }

                // –ò—â–µ–º –±–ª–∏–∂–∞–π—à–µ–≥–æ –∑–æ–º–±–∏
                let nearestZombie = null;
                let nearestDistance = 20; // –†–∞–¥–∏—É—Å –æ–±—Å—Ç—Ä–µ–ª–∞

                obstacles.forEach(obstacleGroup => {
                    const zombie = obstacleGroup.userData.zombie || obstacleGroup.userData.cube;
                    if (!zombie) return;

                    const zombieWorldPos = new THREE.Vector3();
                    zombie.getWorldPosition(zombieWorldPos);

                    const distance = turret.position.distanceTo(zombieWorldPos);
                    if (distance < nearestDistance) {
                        nearestDistance = distance;
                        nearestZombie = { pos: zombieWorldPos, group: obstacleGroup };
                    }
                });

                // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ –∑–æ–º–±–∏, –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—Å—è –∫ –Ω–µ–º—É –∏ —Å—Ç—Ä–µ–ª—è–µ–º
                if (nearestZombie) {
                    const head = turret.userData.head;
                    const barrel = turret.userData.barrel;

                    // –í—ã—á–∏—Å–ª—è–µ–º —É–≥–æ–ª –∫ —Ü–µ–ª–∏
                    const dx = nearestZombie.pos.x - turret.position.x;
                    const dz = nearestZombie.pos.z - turret.position.z;
                    const targetAngle = Math.atan2(dx, dz);

                    // –ü–ª–∞–≤–Ω–æ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≥–æ–ª–æ–≤—É
                    if (head) {
                        head.rotation.y = targetAngle;
                    }
                    if (barrel) {
                        barrel.rotation.y = targetAngle;
                    }

                    // –°—Ç—Ä–µ–ª—è–µ–º –µ—Å–ª–∏ –∫—É–ª–¥–∞—É–Ω –∑–∞–∫–æ–Ω—á–∏–ª—Å—è
                    if (turret.userData.shootCooldown <= 0) {
                        turretShoot(turret, nearestZombie.pos);
                        // –†–∞–∑–Ω—ã–π –∫—É–ª–¥–∞—É–Ω –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç—É—Ä–µ–ª–µ–π
                        const cooldowns = {
                            basic: 20,
                            fire: 40,
                            laser: 5,
                            rocket: 60
                        };
                        turret.userData.shootCooldown = cooldowns[turret.userData.type] || 20;
                    }
                }
            });
        }

        function turretShoot(turret, targetPos) {
            const turretType = turret.userData.type || 'basic';

            // –†–∞–∑–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ç—É—Ä–µ–ª–µ–π
            const bulletConfigs = {
                basic: { size: 0.2, color: 0xffff00, emissive: 0xffff00 },
                fire: { size: 0.3, color: 0xFF4500, emissive: 0xFF4500 },
                laser: { size: 0.15, color: 0x00FFFF, emissive: 0x00FFFF },
                rocket: { size: 0.4, color: 0xAA00FF, emissive: 0xAA00FF }
            };

            const config = bulletConfigs[turretType];
            const bulletGeometry = new THREE.SphereGeometry(config.size, 8, 8);
            const bulletMaterial = new THREE.MeshPhongMaterial({
                color: config.color,
                emissive: config.emissive,
                emissiveIntensity: turretType === 'fire' ? 1.0 : 0.8
            });
            const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);

            bullet.position.set(
                turret.position.x,
                turret.position.y + 1.1,
                turret.position.z
            );

            const direction = new THREE.Vector3()
                .subVectors(targetPos, bullet.position)
                .normalize();

            bullet.userData.direction = direction;
            bullet.userData.isTurretBullet = true;
            bullet.userData.turretType = turretType;

            bullet.castShadow = true;
            scene.add(bullet);
            bullets.push(bullet);
        }

        function animate() {
            animationId = requestAnimationFrame(animate);
            if (gameActive) {
                updatePlayer();
                updateObstacles();
                updateBullets();
                updateTurrets();
                updateCamera();
            }
            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        }

        function onWindowResize() {
            if (camera) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
            }
            if (renderer) {
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º event listeners –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('resize', onWindowResize);
        document.addEventListener('keydown', (e) => keys[e.code] = true);
        document.addEventListener('keyup', (e) => keys[e.code] = false);
        document.getElementById('restart').addEventListener('click', restartGame);
        document.getElementById('changeSkin').addEventListener('click', returnToSkinMenu);
        document.getElementById('openShopBtn').addEventListener('click', () => {
            gameActive = false;
            document.getElementById('shopMenu').style.display = 'block';
            document.getElementById('score').style.display = 'none';
            document.getElementById('instructions').style.display = 'none';
            document.getElementById('weaponDisplay').style.display = 'none';
            document.getElementById('ammoDisplay').style.display = 'none';
            document.getElementById('cameraMode').style.display = 'none';
            document.getElementById('coinsDisplay').style.display = 'none';
            document.getElementById('crosshair').style.display = 'none';
            document.getElementById('openShopBtn').style.display = 'none';
            document.getElementById('openItemsShopBtn').style.display = 'none';
        });

        document.getElementById('openItemsShopBtn').addEventListener('click', () => {
            openShop(false);
        });
        document.getElementById('closeShopBtn').addEventListener('click', closeShop);
        document.getElementById('buyAmmoBtn').addEventListener('click', () => buyAmmo(40, 50));
        document.getElementById('buyAmmoBigBtn').addEventListener('click', () => buyAmmo(100, 100));
        // document.getElementById('closeShop').addEventListener('click', () => {
        //     closeShop();
        //     gameActive = true;
        // });
        document.getElementById('closeShopBtn').addEventListener('click', () => {
            closeShop();
            gameActive = true;
        });
        document.getElementById('exitShopBtn').addEventListener('click', () => {
            document.getElementById('itemsShopMenu').style.display = 'none';
            returnToSkinMenu();
        });

        document.getElementById('continueBtn').addEventListener('click', () => {
            document.getElementById('itemsShopMenu').style.display = 'none';
            document.getElementById('score').style.display = 'block';
            document.getElementById('instructions').style.display = 'block';
            document.getElementById('weaponDisplay').style.display = 'block';
            document.getElementById('ammoDisplay').style.display = 'block';
            document.getElementById('cameraMode').style.display = 'block';
            document.getElementById('coinsDisplay').style.display = 'block';
            if (cameraMode === 'firstPerson') {
                document.getElementById('crosshair').style.display = 'block';
            }
            gameActive = true;
        });

        document.getElementById('exitShopBtn').addEventListener('click', () => {
            document.getElementById('itemsShopMenu').style.display = 'none';
            returnToSkinMenu();
        });

        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é selectSkin –≥–ª–æ–±–∞–ª—å–Ω–æ–π –¥–ª—è onclick
        window.selectSkin = selectSkin;

        // init() –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Å–∫–∏–Ω–∞
    </script>

    <!-- –ü—Ä–∏—Ü–µ–ª –¥–ª—è –≤–∏–¥–∞ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞ -->
    <div id="crosshair" style="display: none;">
        <div class="crosshair-line crosshair-h"></div>
        <div class="crosshair-line crosshair-v"></div>
        <div class="crosshair-dot"></div>
    </div>

    <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div id="mobileControls">
        <button class="control-button" id="leftBtn">‚Üê</button>
        <button class="control-button" id="rightBtn">‚Üí</button>
        <button class="control-button" id="jumpBtn">‚¨Ü</button>
        <button class="control-button" id="shootBtn">üî•</button>
        <button class="control-button" id="weapon1Btn">üî´</button>
        <button class="control-button" id="weapon2Btn">üéØ</button>
        <button class="control-button" id="weapon3Btn">‚ö°</button>
        <button class="control-button" id="weapon4Btn">üåÄ</button>
        <button class="control-button" id="cameraModeBtn">üì∑</button>
    </div>

    <script>
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
        document.getElementById('leftBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            keys['ArrowLeft'] = true;
        });
        document.getElementById('leftBtn').addEventListener('touchend', (e) => {
            e.preventDefault();
            keys['ArrowLeft'] = false;
        });

        document.getElementById('rightBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            keys['ArrowRight'] = true;
        });
        document.getElementById('rightBtn').addEventListener('touchend', (e) => {
            e.preventDefault();
            keys['ArrowRight'] = false;
        });

        document.getElementById('jumpBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            keys['Space'] = true;
        });
        document.getElementById('jumpBtn').addEventListener('touchend', (e) => {
            e.preventDefault();
            keys['Space'] = false;
        });

        document.getElementById('shootBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            keys['KeyW'] = true;
        });
        document.getElementById('shootBtn').addEventListener('touchend', (e) => {
            e.preventDefault();
            keys['KeyW'] = false;
        });

        document.getElementById('weapon1Btn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            changeWeapon('pistol');
        });

        document.getElementById('weapon2Btn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            changeWeapon('rifle');
        });

        document.getElementById('weapon3Btn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (unlockedWeapons.includes('laser')) {
                changeWeapon('laser');
            }
        });

        document.getElementById('weapon4Btn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (unlockedWeapons.includes('gravity')) {
                changeWeapon('gravity');
            }
        });

        document.getElementById('cameraModeBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (cameraMode === 'firstPerson') {
                cameraMode = 'thirdPerson';
                document.getElementById('crosshair').style.display = 'none';
            } else {
                cameraMode = 'firstPerson';
                document.getElementById('crosshair').style.display = 'block';
            }
        });
    </script>
</body>
</html>
